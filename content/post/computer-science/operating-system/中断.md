---
draft: false
date: 2022-04-16 08:00:00 +0800
title: "中断"
summary: "硬件中断；软件中断；中断处理例程和中断处理程序；"
toc: true

categories:
  - 操作系统

tags:
  - 计算机科学
  - 操作系统
  - 中断
---

## 前言

前置笔记：
[进程的创建、进程的运行、进程的内存资源、进程的退出、进程的回收](/post/computer-science/operating-system/linux/process)

实践的环境：同 [程序]()

## 资料

- [{demo-c}](https://github.com/KelipuTe/demo-c)/demo-in-linux/signal/

## 正文

### 硬件中断

硬件中断（hardware interrupt）是一个由硬件设备产生的信号，它需要 CPU 关注。
硬件中断用于允许硬件设备与 CPU 进行通信，而不需要一直轮询或者等待 CPU 关注。

当一个硬件设备产生一个中断时，它向中断控制器发送一个信号。
然后，中断控制器（interrupt controller）向 CPU 发送一个信号，中断其当前任务并处理该设备的请求。
然后，CPU 将停止执行其当前任务并处理中断，这包括暂时保存 CPU 的状态和执行中断处理例程（interrupt handler routine）。

中断处理例程是一段由 CPU 响应中断而执行的代码。
它负责确定是哪个设备产生了中断，处理来自该设备的请求，并恢复 CPU 的状态，以便它能够恢复其先前的任务。

硬件中断对于计算机系统的正常运行至关重要，因为它们允许硬件设备与 CPU 进行交互，而不会垄断 CPU 的资源。
产生中断的硬件设备的常见例子包括键盘、鼠标、网卡和硬盘。

硬件中断可以大概分为下面几部分：中断请求，中断响应，保护现场，中断处理，恢复现场，中断返回。

比如，CPU 正在跑一个程序。这时，按一下键盘（产生中断请求）。这个中断请求被发给 CPU 之后，CPU 会做出反应（中断响应）。

这时，CPU 会先停下正在跑的程序，把程序现在的状态记下来（保护现场）。
然后，过来处理这个中断请求（中断处理）。这个时候 CPU 里跑的是另外一个程序（中断处理例程）。

中断处理例程执行结束之后，需要把状态恢复到刚才停下的那个时候（恢复现场）。
这次中断就完事了，从中断处理例程中退出来（中断返回）。然后，就可以继续执行程序了。

### 软件中断

软件中断（software interrupt）也被称为陷阱（trap）或异常（exception），是一个由程序产生的信号。
它使 CPU 中断其当前任务并执行一个特定的例程（routine）来处理中断。
与由外部硬件设备产生的硬件中断不同，软件中断是由 CPU 上运行的程序产生的。

有两种主要的软件中断类型：同步（synchronous）和异步（asynchronous）。
同步中断是由 CPU 响应程序中的指令而产生的，比如，除以 0 或无效的内存访问。
异步中断是由外部事件产生的，比如，一个定时器或来自另一个进程的信号。

当一个软件中断产生时，CPU 会保存程序的当前状态，包括指令指针和寄存器值，并跳转到一个特定的例程，称为中断处理程序或异常处理程序。
中断处理程序负责处理中断，其中可能涉及错误处理、内存管理或 I/O 操作等任务。

中断处理完毕后，CPU 恢复程序的保存状态，并在被中断的地方恢复执行。
软件中断是程序与操作系统进行通信和执行需要特权访问的任务的重要机制，比如，系统调用或中断另一个进程。

### 中断处理例程和中断处理程序的区别

中断处理例程（interrupt handler routine）和中断处理程序（interrupt handler）的关键区别在于，
中断处理例程是响应硬件设备的中断信号而执行的代码，而中断处理程序是管理中断信号并调用适当的中断处理例程的代码。
