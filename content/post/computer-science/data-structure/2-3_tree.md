---
draft: false
date: 2022-08-01 08:00:00 +0800
lastmod: 2022-08-01 08:00:00 +0800
title: "2-3 树"
summary: "2-3 树的插入、平衡、删除。"

categories:
  - data-structure(数据结构)

tags:
  - computer-science(计算机科学)
  - data-structure(数据结构)
  - b-tree
---
  
### 资料

- <a href="/drawio/computer-science/data-structure/2-3_tree.drawio.html">2-3_tree.drawio.html</a>

### 2-3 树

- 2-3 树就是 3 阶 B-树。
- 把 2-3 树的三结点拆开，就可以变成红黑树。

### 2-3 树的性质

1、满足二叉查找树的基本性质。

2、结点可以存放一个元素、两个元素。

- 假设结点结构从左到右分别为：`子树 1、元素 1、子树 2、元素 2、子树 3`。
- 对于存放一个元素的结点，其形态为：`子树 1、元素 1、子树 2`。
  - `子树 1` 存放比 `元素 1` 小的元素；
  - `子树 2` 存放比 `元素 1` 大的元素。
- 对于存放两个元素的结点，其形态为：`子树 1、元素 1、子树 2、元素 2、子树 3`。
  - `子树 1` 存放比 `元素 1` 和 `元素 2` 都小的元素；
  - `子树 2` 存放在 `元素 1` 和 `元素 2` 之间的元素；
  - 子树 3 存放比 `元素 1` 和 `元素 2` 都大的元素。

3、2-3 树是绝对平衡的二叉查找树，所有叶子结点都在同一层上。从根结点到任意一个叶子结点所经过的结点数是相同的。

### 2-3 树的插入

**下面列举的情况并不一定覆盖所有的场景，但是典型场景都有了，没有提到的场景可以根据典型场景推导。**

#### 只上溢不旋转的情况

1、空树。

添加结点 => 变二结点。（见图：**2-3_tree.drawio.html 2-2-2**）

2、二结点。

添加结点 => 变三结点。（见图：**2-3_tree.drawio.html 2-2-4**）

3、没有父结点的三结点。

添加结点 => 变四结点 => 上溢（层数增加）。（见图：**2-3_tree.drawio.html 2-4-2**）

4、有父结点的三结点（父结点不是三结点）。

添加结点 => 变四结点 => 上溢（层数不增加）。（见图：**2-3_tree.drawio.html 2-4-4**）

这种情况，三结点是父结点哪个子结点，都是一样的处理逻辑，上溢一次。

5、有父结点的三结点（父结点是三结点）。

添加结点 => 变四结点 => 上溢（父结点变四结点）=> 父结点上溢（层数增加）。（见图：**2-3_tree.drawio.html 2-6**）

这种情况，四结点是父结点哪个子结点，都是一样的处理逻辑，上溢两次。

#### 可以通过旋转抵消上溢的情况

1、有父结点的三结点（父结点是三结点、兄弟结点不是三结点）。

添加结点 => 变四结点 => 兄弟结点有空位 => 旋转结点到兄弟结点（抵消上溢，层数不增加）。

这种情况，如果只上溢的话，会上溢两次（自己上溢一次、父结点上溢一次），树的深度增加了，可能影响查询效率。

但是这个时候其实 2-3 树是不满的，兄弟结点是有空位的。这时候就可以通过旋转，重新平衡 2-3 树。

根据 2-3 树有空位的兄弟结点的位置，旋转的情况分为四种，处理方式是差不多的：

- 向右旋转一次（见图：**2-3_tree.drawio.html 4-2-2**）
- 向左旋转一次（见图：**2-3_tree.drawio.html 4-2-4**）
- 向右旋转两次（见图：**2-3_tree.drawio.html 4-4**）
- 向左旋转两次（无图，参考向右旋转两次的图）。

2、有父结点的三结点（父结点是三结点、兄弟结点是三结点、祖父结点是三结点、叔叔结点不是三结点）。

添加结点 => 变四结点 => 父结点和兄弟结点都没有空位，无法旋转，只能上溢（父结点变四结点） => 叔叔结点有空位 => 旋转结点到叔叔结点（抵消上溢，层数不增加）。

这种情况，如果只上溢的话，会上溢三次（自己上溢一次、父结点上溢一次、祖父结点上溢一次），树的深度增加了，可能影响查询效率。

但是这个时候其实 2-3 树是不满的，叔叔结点是有空位的。这时候就可以通过旋转，重新平衡 2-3 树。

这里第一次的上溢是避免不了的。上溢之后，重新以父结点为参照，这时就可以看做上面第一种情况。

根据 2-3 树有空位的叔叔结点的位置，旋转的情况分为四种，处理方式是差不多的：

- （上溢一次后）向右旋转一次（见图：**2-3_tree.drawio.html 4-6-2**）
- （上溢一次后）向左旋转一次（无图，参考向右旋转一次的图）
- （上溢一次后）向右旋转两次（见图：**2-3_tree.drawio.html 4-6-4**）
- （上溢一次后）向左旋转两次（无图，参考向右旋转两次的图）。

### 2-3 树的删除

**下面列举的情况并不一定覆盖所有的场景，但是典型场景都有了，没有提到的场景可以根据典型场景推导。**

#### 删除叶子结点

1、删除三结点的结点。

直接删掉就好了，不会破坏 2-3 树的性质。（见图：**2-3_tree.drawio.html 6-2**）

2、删除二结点的结点（父结点是二结点、兄弟结点是二结点）。

删除结点 => 父结点少一个子树 => 父结点**下溢**（唯一的结点，层次减少） => 父结点和兄弟结点**融合**。（见图：**2-3_tree.drawio.html 6-4-2**）

这种情况，删掉结点之后，自己这个位置就是空的了。也就是父结点变得少一个子树，这会破坏 2-3 树的性质。

处理方式是，就把父结点放到下面一层去，和兄弟结点融合成一个结点，这样就不会破坏 2-3 树的性质了。

图里的例子是父结点的子树 1 被删空了，子树 2 被删空的情况是一样的处理方式。

3、删除二结点的结点（父结点是三结点、兄弟结点都是二结点）。（类似第 2 种情况）

删除结点 => 父结点少一个子树 => 父结点**下溢**（其中一个结点，层次不变） => 下溢结点和兄弟结点**融合**。（见图：**2-3_tree.drawio.html 6-4-4**）

4、删除二结点的结点（父结点是二结点、兄弟结点是三结点）。

删除结点 => 父结点少一个子树 => 兄弟结点可以借一个结点 => **旋转**结点到删除结点的位置。（见图：**2-3_tree.drawio.html 6-6-2**）

这种情况，删掉结点之后，自己这个位置就是空的了。也就是父结点变得少一个子树，这会破坏 2-3 树的性质。

和上面第 2 种情况不同的是，在第 2 种情况中，兄弟结点是二结点，借不出结点。而这里可以借一个结点过来，把这个子树补上，这样就不破坏 2-3 树的性质了。

图里的例子是向左旋转一次的情况，向右旋转一次的处理方式是一样的。

另外，还有向左旋转两次的情况（见图：**2-3_tree.drawio.html 6-10-2**），向右旋转两次的处理方式是一样的。

5、删除二结点的结点（父结点是三结点、兄弟结点是三结点）。

删除结点 => 父结点少一个子树 => 兄弟结点可以借一个结点 => **旋转**结点到删除结点的位置。（见图：**2-3_tree.drawio.html 6-6-4**）

图里的例子是向左旋转一次的情况，向右旋转一次的处理方式是一样的。

6、删除二结点的结点（父结点是二结点、兄弟结点是二结点、祖父结点是二结点、叔叔结点是二结点）。

删除结点 => 父结点少一个子树 => 父结点**下溢**（父结点和兄弟结点**融合**） => 祖父结点少一个子树 => 祖父结点**下溢**（唯一的结点，层次减少） => 祖父结点和叔叔结点**融合**。（见图：**2-3_tree.drawio.html 6-12-2**）

这种情况，初始场景类似上面第 2 种情况，解决方案也是类似第 2 种情况的：下溢 + 融合。初始场景处理完之后，重新以父结点为参照，又是类似上面第 2 种情况，再来一遍就好了。

7、删除二结点的结点（父结点是二结点、兄弟结点是二结点、祖父结点是三结点、叔叔结点是二结点）。

删除结点 => 父结点少一个子树 => 父结点**下溢**（父结点和兄弟结点**融合**） => 祖父结点少一个子树 => 祖父结点**下溢**（其中一个结点，层次不变） => 下溢结点和叔叔结点**融合**。（见图：**2-3_tree.drawio.html 6-12-4**）

这种情况，初始场景类似上面第 2 种情况，解决方案也是类似第 2 种情况的：下溢 + 融合。初始场景处理完之后，重新以父结点为参照，类似上面第 3 种情况，解决方案也是类似第 3 种情况的：下溢 + 融合。

8、删除二结点的结点（父结点是二结点、兄弟结点是二结点、祖父结点是三结点、叔叔结点是三结点）。

删除结点 => 父结点少一个子树 => 父结点**下溢**（父结点和兄弟结点**融合**） => 祖父结点少一个子树 => 叔叔结点可以借一个结点 => **旋转**结点到祖父结点的删除结点的位置。（见图：**2-3_tree.drawio.html 6-14**）

这种情况，初始场景类似上面第 2 种情况，解决方案也是类似第 2 种情况的：下溢 + 融合。初始场景处理完之后，重新以父结点为参照，类似上面第 4 种情况，解决方案也是类似第 4 种情况的：旋转。

#### 删除的不是叶子结点

这种情况需和平衡二叉树一样，找到中序遍历的前驱结点或者后继结点，把这两个结点互换位置，这个时候要删除的结点会被换到叶子结点的位置，然后再删除。

### 2-3 树转换成红黑树

- 1、三结点其中一个元素转化为红黑树的红结点，左右哪个元素都可以。
- 2、拆分三结点，和父结点连接的一定是黑结点。
- （见图：**2-3_tree.drawio.html 10-2**）

### reference（参考）

- [二三树、B树(多路平衡查找树)、B+树](https://zhuanlan.zhihu.com/p/363917075)
- [二叉树，红黑树，23树，B树，B+树](https://blog.csdn.net/weixin_53184069/article/details/123717396)
- [2-3树的删除](https://blog.csdn.net/mengzhisuoliu/article/details/44752215)
- [bilibili--天羽神奈](https://space.bilibili.com/488466813)
    - [2-3树的定义与搜索](https://www.bilibili.com/video/BV1zL41157u6)
    - [图解2-3树插入节点方法](https://www.bilibili.com/video/BV1W44y1J7N1)
    - [2-3树删除节点图解及示例](https://www.bilibili.com/video/BV1Rb4y1e7qa)
