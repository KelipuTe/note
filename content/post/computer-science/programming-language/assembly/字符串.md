---
draft: false
date: 2023-07-15 08:00:00 +0800
title: "字符串（笔记片段）"
summary: "字符串传输；字符串比较；"
toc: true

categories:
  - assembly-language(汇编语言)

tags:
  - computer-science(计算机科学)
  - programming-language(编程语言)
  - assembly-language(汇编语言)
---

## 前言

这篇笔记需要 intel x86-64 架构、数据传输、流程控制、整数、gdb 调试相关的知识。

实践的环境：同 [x86-64_架构]()

## 资料

笔记里的代码都在 {demo-assembly}/demo-in-linux/string/ 目录下。

## 正文

### movs

movs，传输字符串。`movs`。源操作数和目标操作数都位于内存中。
源操作数的地址从 rsi 寄存器读取。目的操作数地址从 rdi 寄存器读取。
使用 movs 之前，必须正确加载这两个寄存器。

每执行一次 movs 指令，就会按照指令设置的字节、字、双字、四字传输一次。
然后，rsi 和 rdi 上存储的地址都会自动增加或者减少对应的位数。

rsi 和 rdi 上存储的地址是增加或者减少，这个由 eflags 寄存器的 df 标志决定。
df = 0 的时候增加，可以通过 cld 指令设置；df = 1 的时候减少，可以通过 std 指令设置。默认是增加的。

代码示例：{demo-assembly}/demo-in-linux/string/movs.asm

想要传输完整的字符串，可以使用循环结构来处理，也可以用 rep。
rep，按 rcx 计数寄存器中指定的次数重复字符串指令，或者重复到不再满足 eflags 的 zf 标志的指定条件。
rep 可以加载字符串指令前面作为前缀。像这样 `rep movs`。

和 rep 相似的有 5 个指令。rep、repe、repz、repne、repnz。
rep 的结束条件是 rcx 计数寄存器为 0。
repe、repz 的结束条件是 rcx 计数寄存器为 0 或者 zf 标志为 0。
repne、repnz 的结束条件是 rcx 计数寄存器为 0 或者 zf 标志为 1。

### lods、stos

lods，加载字符串。`lods`。源操作数是内存位置，源操作数的地址从 rsi 寄存器读取。
将一个字节、字、双字从源操作数加载到 al、ax 或 eax 寄存器。

stos，保存字符串。`stos`。目标操作数是一个内存位置，目标操作数的地址从 rdi 寄存器读取
将 al、ax、eax 寄存器中的字节、字、双字存储到目标操作数中。

在执行这两个指令之前，必须正确加载寄存器。

数据传输完成后，和 movs 一个套路，rsi 和 rdi 上存储的地址都会自动增加或者减少对应的位数。

代码示例：{demo-assembly}/demo-in-linux/string/lods_and_stos.asm

代码示例：{demo-assembly}/demo-in-linux/string/to_upper.asm

### cmps

cmps，字符串比较。`cmps`。源操作数和目标操作数都位于内存中。
源操作数的地址从 rsi 寄存器读取。目的操作数地址从 rdi 寄存器读取。
使用 movs 之前，必须正确加载这两个寄存器。

cmps 将源操作数指定的字节、字、双字节、四字节与目标操作数指定的字节、字、双字节、四字节进行比较。
相等的话，就设置 eflags 的 zf 标志为 1。不相等的话，就设置 eflags 的 zf 标志为 0。

每执行一次 cmps 指令，就会比较一次。
然后，和 movs 一个套路，rsi 和 rdi 上存储的地址都会自动增加或者减少对应的位数。

代码示例：{demo-assembly}/demo-in-linux/string/cmps.asm

想要比较完整的字符串，可以使用循环结构来处理，也可以用 rep。

### scasb

scasb，字符串比较。`scasb`。内存操作数地址从 rdi 寄存器中读取。

scasb 使用内存操作数指定的字节、字、双字、四字与 al、ax、eax 中的值进行比较。
相等的话，就设置 eflags 的 zf 标志为 1。不相等的话，就设置 eflags 的 zf 标志为 0。

每执行一次 cmps 指令，就会比较一次。然后，和 movs 一个套路，rdi 上存储的地址都会自动增加或者减少对应的位数。

代码示例：{demo-assembly}/demo-in-linux/string/scas.asm
