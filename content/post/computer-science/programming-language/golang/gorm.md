一个因为事务没有提交而产生的的问题

从 gorm 连接池开启事务之后，如果事务里面有加锁的语句，而且最终事务没有被提交或者回滚的话
会导致数据库连接资源被长时间占用，当数据库链接资源被消耗完的时候，就会出现大量的外部请求超时
如果是用 nginx 进行反向代理的话，就表现为 nginx 日志里面大量出现因为超时而主动断开的状态为 499 的请求
499 产生的直接原因是，外部请求在等待数据库资源，直到超时

如果是直接连接的，那么连接被关闭之后，这个事务就会自动回滚，锁也就被释放掉了
但是如果用的是连接池的话，这个连接本身就会存在很长时间，就会导致这个事务还有事务里的锁会存在很长时间
而且一般的服务都会有全局的recover机制，所以这个请求就算panic了，这个连接也不会释放
到了这一步，这个事务什么时候结束就受 mysql 的设置影响了，有可能是 6-8 个小时，这个只是听说没有找到验证

如果没有用连接池，每个请求来都自己新建连接，也会产生大量请求超时 499 的情况
原因很简单，当有大量的请求打过来的时候，资源都被消耗去建立数据库连接了，也会造成大量的超时

nginx或者操作系统连接资源被耗尽的情况

场景是这样的，外部订单请求打进来，因为业务场景是一份库存上架多个渠道售卖，
所以这里一个渠道的订单会并发出多个渠道的库存请求，然后大量的请求因为对海访问的外网络慢，
不知道是不是把ngxin的连接资源耗尽了，开始出现命名没有到超时时间但是报了 499 的请求。
加个队列慢慢跑就可以了
