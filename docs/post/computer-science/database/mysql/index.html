<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.103.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="索引（Index）"><meta itemprop=description content><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/image/pid49256268.jpg"><meta itemprop=keywords content="computer-science(计算机科学),database(数据库),mysql"><meta property="og:type" content="article"><meta property="og:title" content="索引（Index）"><meta property="og:description" content><meta property="og:image" content="/image/pid49256268.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/post/computer-science/database/mysql/"><meta property="og:site_name" content="帕里特档案馆"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="西柊慧音"><meta property="article:published_time" content="2022-05-26 08:00:00 +0800 CST"><meta property="article:modified_time" content="2022-05-26 08:00:00 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.4da9279b6033ade10d67092d7bfb660265f9fa46c40974f17b13bfe235396546.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"mysql","permalink":"/post/computer-science/database/mysql/","title":"索引（Index）","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>索引（Index） - 帕里特档案馆</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>帕里特档案馆</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>重建中</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>107</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><ul><li><a href=#索引模型>索引模型</a></li><li><a href=#innodb>InnoDB</a></li><li><a href=#索引类型>索引类型</a></li><li><a href=#回表>回表</a></li><li><a href=#索引覆盖>索引覆盖</a></li><li><a href=#change-buffer>change buffer</a></li><li><a href=#change-buffer-和-redo-log>change buffer 和 redo log</a></li><li><a href=#唯一索引和普通索引的比较>唯一索引和普通索引的比较</a><ul><li><a href=#查询过程>查询过程</a></li><li><a href=#更新过程>更新过程</a></li></ul></li><li><a href=#索引下推>索引下推</a></li><li><a href=#索引失效index-invalid>索引失效（Index Invalid）</a><ul><li><a href=#like>like</a></li><li><a href=#联合索引非最左匹配>联合索引非最左匹配</a></li><li><a href=#or>or</a></li><li><a href=#对索引进行表达式计算>对索引进行表达式计算</a></li><li><a href=#索引隐式类型转换>索引隐式类型转换</a></li></ul></li><li><a href=#字符串字段加索引>字符串字段加索引</a></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=西柊慧音 src=/imgs/img-lazy-loading.gif data-src=/image/pid49256268.jpg><p class=site-author-name itemprop=name>西柊慧音</p><div class=site-description itemprop=description></div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>107</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>19</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>67</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/KelipuTe title="Github → https://github.com/KelipuTe" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=xhy_1365@sina.com title="E-Mail → xhy_1365@sina.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/post/computer-science/database/mysql/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/image/pid49256268.jpg"><meta itemprop=name content="西柊慧音"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="西柊慧音"><meta itemprop=description content></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="索引（Index）"><meta itemprop=description content="索引（Index）"></span><header class=post-header><h1 class=post-title itemprop="name headline">索引（Index）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-05-26 08:00:00 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-05-26 08:00:00 +0800 CST">2022-05-26</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/database itemprop=url rel=index><span itemprop=name>database</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>4149</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>9分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv data-path=/post/computer-science/database/mysql/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>索引（Index）就像书的目录一样，可以提高查询的效率。</p><h3 id=索引模型>索引模型</h3><p>可以用于提高读写效率的数据结构有很多。</p><ul><li>等值查询：哈希表、有序数组、跳表、搜索树（平衡二叉树、红黑树、B 树、B+ 树）等。</li><li>范围查询：有序数组、有序双向链表、双向跳表、搜索树（B 树、B+ 树）等。</li></ul><p>但是数据库的场景要求等值查询和范围查询都要有。</p><ul><li>哈希表适用于只有等值查询的场景，没有范围查询的能力</li><li>有序数组适用于只有静态存储的场景，插入和删除代价太大</li></ul><p>两个要求同时符合的有：双向跳表、搜索树（B 树、B+ 树）等。</p><p>B+ 树相比 B 树的优势：</p><ul><li>插入和删除的时候，B 树可能需要移动结点（因为 B 数的结构，如果是上层结点被删了，一定要调整结点的），B+ 树可以不移动（只删除叶子结点，上层结点只是索引用的可以不删除）。</li><li>在范围查询的时候，B 树使用中序遍历访问的的结点数量，比 B+ 树使用叶子结点的双向链表结构访问的结点数量多。这意味着B 树可能需要更多的硬盘 IO。</li></ul><h3 id=innodb>InnoDB</h3><p>InnoDB 使用的索引模型是 B+ 树。在 InnoDB 中，每一个索引都对应一棵 B+ 树，</p><p>索引是存放在数据页（文件）里的，它要占据物理空间。B+ 树为了维护索引有序性，在插入新值的时候会做必要的维护。如果页已经满了，这时候需要申请一个新的页，然后挪动部分数据过去，这个过程称为页分裂。当相邻的两个页由于删除了数据，利用率很低之后，又会将两个页做合并。</p><p>索引分为聚簇索引（主键索引）和非聚簇索引（二级索引）。</p><ul><li>对主键字段建立的索引是聚簇索引，主键索引只有一个</li><li>聚簇索引的叶子结点存放的是实际数据，也就是用户记录</li><li>对普通字段建立的索引是二级索引，二级索引可以创建多个</li><li>二级索引的叶子结点存放的不是实际数据，而是主键值</li></ul><p>对于主键索引，一般建议使用自增主键。因为自增主键长度小，而二级索引的叶子结点存放的是主键值，这样二级索引占的空间就小。</p><p>由于数据页的大小是固定的，索引字段长度越小，一个页内就可以放的越多，这样整体涉及的页就越少。涉及的页越少意味着硬盘 IO 越少。</p><p>对于二级索引，一般建议使用长度小、重合度小的字段，重合度越小的字段查询起来效率越高。</p><h3 id=索引类型>索引类型</h3><ul><li>主键索引：数据列不允许重复，不允许为 NULL，一个表只能有一个主键。</li><li>唯一索引：数据列不允许重复，允许为 NULL 值，一个表允许多个列创建唯一索引。</li><li>普通索引：数据列允许重复，允许为 NULL 值，一个表允许多个列创建普通索引。</li><li>联合索引（组合索引）：多个数据列组合在一起创建的索引（唯一索引、普通索引）。</li></ul><p>创建普通索引的时候，因为二级索引里同时有索引字段和主键字段，相当于创建了一个<code>普通字段+主键字段</code>的联合索引。</p><p>创建联合索引的时候会创建多个索引，如创建联合索引 (a,b,c) 的时候会创建 (a)、(a,b)、(a,b,c) 三个索引。使用联合索引需要遵循最左匹配原则。</p><h3 id=回表>回表</h3><p>如果某个查询语句使用了二级索引，但是查询的数据是整行记录。这时在二级索引找到主键后，需要回到聚簇索引中获得整个用户记录。</p><p>这个过程叫作回表，整个查询过程需要查两棵索引树。如果条件允许，尽量使用主键查询，这样就没有回表的步骤了。</p><h3 id=索引覆盖>索引覆盖</h3><p>如果某个查询语句使用了二级索引，而且查询的数据就是主键或者索引字段。这时在二级索引找到主键后，不需要回到聚簇索引中获得用户记录了，因为二级索引中已经存储了主键的值和索引字段的值。这个过程叫索引覆盖，整个查询过程只查了一棵索引树，它可以显著提升查询性能。</p><h3 id=change-buffer>change buffer</h3><p>change buffer 用来更新非主键索引或唯一索引的二级索引 B+ 树的。它是一个可选项，默认是打开的。</p><p>change buffer 是 buffer pool 里的一块区域，存储的是最新的索引数据的变更。主要解决的是随机读硬盘的 IO 问题，将数据从硬盘读入内存涉及随机 IO，是数据库里面成本最高的操作之一。</p><p>当需要更新一个二级索引树的数据页时，如果页在内存中就直接更新，而如果页还没有在内存中的话，在不影响数据一致性的前提下，InnoDB 会将这些更新操作缓存在 change buffer 中，这样就不需要从磁盘中读入这个数据页了。在下次查询需要访问这个页的时候，将页从硬盘读入内存，然后执行 change buffer 中与这个页有关的操作。通过这种方式就能保证这个数据逻辑的正确性。</p><p>虽然名字叫作 change buffer，实际上它是可以持久化的数据，可以看成也是一个数据页。也就是说，change buffer 在内存中有拷贝，也会被写入到硬盘上。同时，change buffer 也是需要写 redo log 的。所以 redo log 里不仅有针对普通数据页的改动记录，也有 change buffer 的记录。</p><p>将 change buffer 中的操作应用到原数据页，得到最新结果的过程称为 merge。除了访问这个数据页会触发 merge 外，系统有后台线程会定期 merge。在数据库正常关闭（shutdown）的过程中，也会执行 merge 操作。显然，如果能够将更新操作先记录在 change buffer，减少读硬盘，语句的执行速度会得到明显的提升。而且，数据读入内存是需要占用 buffer pool 的，所以这种方式还能够避免占用内存，提高内存利用率。</p><p>对于写多读少的业务来说，页面在写完以后马上被访问到的概率比较小，此时 change buffer 的使用效果最好。反过来，假设一个业务的更新模式是写入之后马上会做查询，那么即使满足了条件，将更新先记录在 change buffer，但之后由于马上要访问这个数据页，会立即触发 merge 过程。这样随机访问 IO 的次数不会减少，反而增加了 change buffer 的维护代价。对于这种业务模式来说，change buffer 反而起到了副作用。</p><h3 id=change-buffer-和-redo-log>change buffer 和 redo log</h3><p>redo log 主要节省的是随机写磁盘的 IO 消耗（转成顺序写），而 change buffer 主要节省的则是随机读磁盘的 IO 消耗。</p><p>假设要执行一条语句：<code>mysql> insert into t(id,v) values(id1,v1),(id2,v2);</code>。假设当前 v 索引树的状态，查找到位置后，v1 所在的数据页在内存（InnoDB buffer pool）中，v2 所在的数据页不在内存中。下图是带 change buffer 的更新状态图。</p><div style="text-align:center;margin:5px auto"><img src=/image/computer-science/database/mysql/index_change_buffer_and_redo_log_insert.drawio.png></div><p>更新语句做了如下的操作：</p><ul><li>page1 在内存中，直接更新内存。（图中 1）</li><li>page2 没有在内存中，就在内存的 change buffer 区域，记录下"往 page2 插入一行"这个信息。（图中 2）</li><li>将上述两个动作记入 redo log 中。（图中 3、4）</li></ul><p>做完上面这些，事务就可以完成了。</p><p>现在假设要执行一条语句：<code>select * from t where v in (v1,v2);</code>。下图是查询执行的流程图。</p><div style="text-align:center;margin:5px auto"><img src=/image/computer-science/database/mysql/index_change_buffer_and_redo_log_select.drawio.png></div><ul><li>读 page1 的时候，直接从内存返回。</li><li>读 page2 的时候，需要从硬盘读入内存中，然后应用 change buffer 里面的操作日志，生成一个正确的版本并返回结果。</li></ul><h3 id=唯一索引和普通索引的比较>唯一索引和普通索引的比较</h3><p>这两类索引在查询能力上是没差别的，主要考虑的是对更新性能的影响。所以，建议尽量选择普通索引。</p><h4 id=查询过程>查询过程</h4><ul><li>对于普通索引来说，查找到满足条件的第一个记录后，需要查找下一个记录，直到碰到第一个不满足条件的记录。</li><li>对于唯一索引来说，由于索引定义了唯一性，查找到第一个满足条件的记录后，就会停止继续检索。</li></ul><p>查询过程，这两个没有明显的性能上的差距，普通索引需要读下一页这种属于少数情况。</p><h4 id=更新过程>更新过程</h4><p>对于目标数据在内存中的情况，两者都可以很快的完成更新操作，区别在于目标数据不在内存中的情况。</p><ul><li>对于普通索引来说，因为没有额外的判断条件，直接将更新记录在 change buffer 中，语句执行就结束了。</li><li>对于唯一索引来说，是不能使用 change buffer 的，因为唯一索引需要保证数据不重复，所以一定要去硬盘中把数据对应的数据页读出来，然后判重。</li></ul><p>所以针对更新操作密集的字段，需要慎重添加唯一索引。</p><h3 id=索引下推>索引下推</h3><p>对于联合索引 (a,b,c)，SQL 语句 <code>where a=1 and c=3</code> 是能用到索引的，不过只能用到 a 的索引。这种属于索引截断。</p><p>MySQL 5.6 引入索引下推（index condition pushdown）优化，可以在索引遍历过程中，对索引（这里是 联合索引 (a,b,c)）中包含的字段（这里是 c）先做判断，直接过滤掉不满足条件的记录，减少回表次数。</p><p>如果用到了索引下推，那么 explain 的结果里的 extra 字段会显示 <code>Extra=Using index condition</code>。</p><h3 id=索引失效index-invalid>索引失效（Index Invalid）</h3><h4 id=like>like</h4><p>使用 <code>like '%xxx'</code> 或者 <code>like '%xxx%'</code> 的时候索引会失效。因为索引树是按照索引值有序排列的，只能进行前缀比较。</p><p>但是有个特殊的情况，如果查询的字段全部在索引树中，这个时候虽然索引失效了，但是依然会用到索引树，通过直接扫描整个索引树拿到需要的数据。因为聚簇索引树保存了全部的数据，它一定比二级索引树大，所以扫描二级索引树会快一点。</p><h4 id=联合索引非最左匹配>联合索引非最左匹配</h4><p>如果创建了一个联合索引 (a,b,c)。那么：</p><ul><li><code>where a=1</code>、<code>where a=1 and b=2</code>、<code>where a=1 and b=2 and c=3</code> 都能用到索引。</li><li><code>where b=2</code>、<code>where c=3</code>、<code>where b=2 and c=3</code> 都用不到索引。</li><li>特别的 <code>where a=1 and c=3</code> 是索引截断，MySQL 5.6 及以后的版本会用到索引下推。</li></ul><h4 id=or>or</h4><p>如果在 or 前的条件列是索引列，而在 or 后的条件列不是索引列，那么索引会失效。因为 or 的含义就是两个只要满足一个即可，因此只有一个条件列是索引列是没有意义的，只要有条件列不是索引列，就会进行全表扫描。</p><h4 id=对索引进行表达式计算>对索引进行表达式计算</h4><p>如果 id 字段有索引，那么 <code>where id + 1 = 10</code> 语句就用不到索引，因为索引保存的是索引字段的原始值，对索引进行表达式计算后的值不一定在索引里，只能全表扫描。但是 <code>where id = 10 - 1</code> 语句就可以用到索引。</p><h4 id=索引隐式类型转换>索引隐式类型转换</h4><p>MySQL 在遇到字符串和数字比较的时候，会自动把字符串转为数字，然后再进行比较。<code>select '10' > 9; // 结果是 1</code> 通过这个例子就可以测试转换规则。</p><p>当索引字段是字符串的时候，如果 sql 语句是 <code>where 索引字段 = 123</code>，这时就会把索引字段转换成数字，也就不走索引了。</p><p>当索引字段是数字的时候，如果 sql 语句是 <code>where 索引字段 = '123'</code>，这时就会把 <code>'123'</code> 转换成数字，这个时候就走索引。</p><h3 id=字符串字段加索引>字符串字段加索引</h3><p>有的字符串字段的值可能很长，直接加索引可能非常占空间。</p><p>有几种解决方案可以解决这个问题：</p><ul><li>前缀索引：截取字符串最前面的几个字符作为索引。使用前缀索引时，如果定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本。但是覆盖索引就用不了了，因为不知道截取的字符串完不完整，是一定要回表的。</li><li>倒序存储：如果字符串前缀的区分度不大（比如身份证），就可以用倒序然后再取前缀。</li><li>哈希值字段：把要索引的字符串字段计算一个哈希值，放到一个哈希值字段上，然后在哈希值字段上建立索引，查询的时候使用字符串和哈希值一起查询。</li></ul><h3 id=参考>参考</h3><ul><li><a href=https://time.geekbang.org/ title=极客时间 rel="noopener external nofollow noreferrer" target=_blank class=exturl>极客时间
<i class="fa fa-external-link-alt"></i></a><ul><li><a href="https://time.geekbang.org/column/intro/100020801?tab=catalog" title="MySQL 实战 45 讲" rel="noopener external nofollow noreferrer" target=_blank class=exturl>MySQL 实战 45 讲
<i class="fa fa-external-link-alt"></i></a><ul><li>04 | 深入浅出索引（上）</li><li>05 | 深入浅出索引（下）</li><li>09 | 普通索引和唯一索引，应该怎么选择？</li><li>11 | 怎么给字符串字段加索引？</li></ul></li></ul></li><li><a href=https://xiaolincoding.com/ title=小林coding rel="noopener external nofollow noreferrer" target=_blank class=exturl>小林coding
<i class="fa fa-external-link-alt"></i></a><ul><li><a href=https://xiaolincoding.com/mysql/ title=《图解MySQL》 rel="noopener external nofollow noreferrer" target=_blank class=exturl>《图解MySQL》
<i class="fa fa-external-link-alt"></i></a><ul><li>索引篇：为什么 MySQL 采用 B+ 树作为索引？</li><li>索引篇：索引失效有哪些？</li><li>索引篇：MySQL 使用 like “%x“，索引一定会失效吗？</li></ul></li></ul></li><li><a href=http://www.icodebang.com/article/247207 title="【Mysql核心剖析系列】Change Buffer 与 Redo Log的区别 " rel="noopener external nofollow noreferrer" target=_blank class=exturl>【Mysql核心剖析系列】Change Buffer 与 Redo Log的区别
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/computer-science%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%a7%91%e5%ad%a6>computer-science(计算机科学)</a>
<a href=/tags/database%e6%95%b0%e6%8d%ae%e5%ba%93>database(数据库)</a>
<a href=/tags/mysql>mysql</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
索引（Index）</li><li class=post-copyright-author><strong>本文作者：</strong>
西柊慧音</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=/post/computer-science/database/mysql/ title=索引（Index）>/post/computer-science/database/mysql/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/architecture-design/usability/ rel=next title=可用性><i class="fa fa-chevron-left"></i> 可用性</a></div><div class="post-nav-prev post-nav-item"><a href=/post/computer-science/database/normalization/ rel=prev title="数据库范式（Database Normalization）">数据库范式（Database Normalization）
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>西柊慧音</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.103.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.1 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":false,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.c997eeae723f2fcee19ae5066fcc64a49cefb92ddb75904efdb69a223e5a6740.js defer></script></body></html>