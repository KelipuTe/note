<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.103.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="进程间通信（IPC）"><meta itemprop=description content><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/image/pid49256268.jpg"><meta itemprop=keywords content="computer-science(计算机科学),operating-system(操作系统),ipc(进程间通信)"><meta property="og:type" content="article"><meta property="og:title" content="进程间通信（IPC）"><meta property="og:description" content><meta property="og:image" content="/image/pid49256268.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/post/computer-science/operating-system/linux/ipc/"><meta property="og:site_name" content="帕里特档案馆"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="西柊慧音"><meta property="article:published_time" content="2022-01-24 08:00:00 +0800 CST"><meta property="article:modified_time" content="2022-01-24 08:00:00 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.4da9279b6033ade10d67092d7bfb660265f9fa46c40974f17b13bfe235396546.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"ipc","permalink":"/post/computer-science/operating-system/linux/ipc/","title":"进程间通信（IPC）","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>进程间通信（IPC） - 帕里特档案馆</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>帕里特档案馆</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>重建中</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>87</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#正文>正文</a><ul><li><a href=#进程间通信>进程间通信</a></li><li><a href=#管道>管道</a><ul><li><a href=#匿名管道>匿名管道</a></li><li><a href=#命名管道>命名管道</a></li></ul></li><li><a href=#ipc-对象>IPC 对象</a><ul><li><a href=#消息队列>消息队列</a></li><li><a href=#信号量>信号量</a></li><li><a href=#共享内存>共享内存</a></li></ul></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=西柊慧音 src=/imgs/img-lazy-loading.gif data-src=/image/pid49256268.jpg><p class=site-author-name itemprop=name>西柊慧音</p><div class=site-description itemprop=description></div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>87</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>16</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>62</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/KelipuTe title="Github → https://github.com/KelipuTe" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=xhy_1365@sina.com title="E-Mail → xhy_1365@sina.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/post/computer-science/operating-system/linux/ipc/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/image/pid49256268.jpg"><meta itemprop=name content="西柊慧音"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="西柊慧音"><meta itemprop=description content></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="进程间通信（IPC）"><meta itemprop=description content="管道；匿名管道；命名管道；IPC；消息队列；信号量；共享内存；"></span><header class=post-header><h1 class=post-title itemprop="name headline">进程间通信（IPC）</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-01-24 08:00:00 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-01-24 08:00:00 +0800 CST">2022-01-24</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/operating-system%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F itemprop=url rel=index><span itemprop=name>operating-system(操作系统)</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>2612</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>6分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv data-path=/post/computer-science/operating-system/linux/ipc/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h2 id=前言>前言</h2><p>前置笔记：
<a href=/post/computer-science/operating-system/linux/exec_elf title="运行 ELF 文件">运行 ELF 文件</a></p><p>实践的环境：同
<a href title=程序>程序</a></p><h2 id=正文>正文</h2><h3 id=进程间通信>进程间通信</h3><p>进程间通信（Inter Process Communication，IPC）指的是在同一台机器上的不同进程之间传播或交换信息。</p><p>ipc 的方法主要包括 pipe（管道）和 ipc 对象（消息队列、信号量、共享内存）。管道包括匿名管道和命名管道。</p><p>ipc 对象有两个标准，一个是比较老的 &ldquo;SYSTEM V&rdquo; 标准的消息队列、信号量、共享内存，
另一个是比较新的 POSIX 标准的消息队列、信号量、共享内存。</p><h3 id=管道>管道</h3><blockquote><p>pipe(7)</br>Pipes and FIFOs (also known as named pipes) provide a unidirectional interprocess communication channel.
A pipe has a read end and a write end.
Data written to the write end of a pipe can be read from the read end of the pipe.</br></p></blockquote><p>管道提供了一个单向的进程间通信通道。一个管道有一个读取端和一个写入端。
写入管道写入端的数据的数据可以从该管道的读取端读出。数据只能单向流动，数据从写入端流向读取端。</p><p>管道依赖 linux 内核实现，管道的本质是在内核中的一块内存（也叫内核缓冲区），
这块缓冲区中的数据存储在一个环形队列中，由于管道在内核区，我们不能直接对其操作。</p><p>本质上是文件 I/O 操作。内核中管道两端分别对应两个文件描述符，
通过写端的文件描述符把数据写入管道中，通过读端的文件描述符将数据从管道中读出来，
读写管道的函数就是 linux 中的文件 I/O 函数。</p><p>管道分为匿名管道和命名管道。匿名管道，没有可以提供给外部的标识，所以，一般用于父子进程之间。
命名管道，有可以提供给外部的标识，所以，可以用于非父子进程之间。</p><h4 id=匿名管道>匿名管道</h4><blockquote><p>pipe(7)</br>A pipe is created using pipe(2), which creates a new pipe and returns two file descriptors,
one referring to the read end of the pipe, the other referring to the write end.
Pipes can be used to create a communication channel between
related processes; see pipe(2) for an example.</p></blockquote><p>示例代码：{demo-c}/demo-in-linux/ipc/unnamed_pipe/unnamed_pipe.c</p><h4 id=命名管道>命名管道</h4><p>示例代码：</p><ul><li>父子进程：{demo-c}/demo-in-linux/ipc/named_pipes/parent_child.c</li><li>非父子进程读取：{demo-c}/demo-in-linux/ipc/named_pipes/pipe_read.c</li><li>非父子进程写入：{demo-c}/demo-in-linux/ipc/named_pipes/pipe_write.c</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; file fifo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fifo: fifo (named pipe)
</span></span></code></pre></div><p>可以使用 file 命令查看 fifo 的文件类型，可以看到这是个命名管道。</p><p>在 win10 环境的 docker 环境的 linux 环境中创建 fifo 文件时会出现 &ldquo;Input/output error&rdquo; 报错。
这是因为 docker 目录是 win10 目录映射来的，创建不了 fifo 文件。
解决办是用 linux 环境中的目录，测试的时候可以先用 &ldquo;/tmp&rdquo; 目录。</p><h3 id=ipc-对象>IPC 对象</h3><blockquote><p>ipc(2)</br>ipc() is a common kernel entry point for the System V IPC calls for messages, semaphores, and shared memory.
call determines which IPC function to invoke; the other arguments are passed through to the appropriate call.</br></p></blockquote><p>ipc 对象包括消息队列、信号量、共享内存。创建 ipc 对象时需要指定一个 key（键，标识符）。
key 是指 ipc 对象在操作系统内部的唯一标识，在多个进程通信时用作关联。</p><p>ipc 相关的 linux 命令：ipcs、ipcrm。</p><h4 id=消息队列>消息队列</h4><p>消息队列的实现依赖 linux 内核，并且它的数据存储在内核中。</p><p>示例代码：</p><ul><li>创建：<code>demo_c/demo_linux_c/ipc/message_queue/msgget.c</code></li><li>发送：<code>demo_c/demo_linux_c/ipc/message_queue/msgsnd.c</code></li><li>接收：<code>demo_c/demo_linux_c/ipc/message_queue/msgrcv.c</code></li><li>控制：<code>demo_c/demo_linux_c/ipc/message_queue/msgctl.c</code></li></ul><p>创建一个消息队列。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./msgget.elf
</span></span><span style=display:flex><span>[debug]:mqId=0, errno=0, error=Success
</span></span></code></pre></div><p>消息队列创建完成后，可以通过 ipcs 命令查看，通过 key 字段可以找到创建的消息队列。
向消息队列发送消息后，used-bytes 字段会显示消息队列使用的大小，messages 字段会显示未处理消息的条数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ipcs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------ Message Queues --------
</span></span><span style=display:flex><span>key        msqid      owner      perms      used-bytes   messages    
</span></span><span style=display:flex><span>0x00001000 0          qqq        666        1024         0
</span></span></code></pre></div><p>发送一条消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./msgsnd.elf
</span></span><span style=display:flex><span>[debug]:msgsndResult=0
</span></span></code></pre></div><p>查看消息队列的情况，可以看到，里面有一条消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./msgctl.elf
</span></span><span style=display:flex><span>[debug]:msgctlResult=0, buf.msg_qnum=1
</span></span></code></pre></div><p>通过 ipcs 命令查看，可以看到，未处理消息的条数变成 1 了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ipcs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------ Message Queues --------
</span></span><span style=display:flex><span>key        msqid      owner      perms      used-bytes   messages    
</span></span><span style=display:flex><span>0x00001000 0          qqq        666        1024         1
</span></span></code></pre></div><p>接收一条消息。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./msgrcv.elf
</span></span><span style=display:flex><span>[debug]:msgrcvResult=1024, msg.mtext=hello, msg.mtype=1
</span></span></code></pre></div><p>查看消息队列的情况，可以看到消息已经被取走了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./msgctl.elf
</span></span><span style=display:flex><span>[debug]:msgctlResult=0, buf.msg_qnum=0
</span></span></code></pre></div><p>通过 ipcs 命令查看，可以看到，未处理消息的条数变成 0 了。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ipcs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------ Message Queues --------
</span></span><span style=display:flex><span>key        msqid      owner      perms      used-bytes   messages    
</span></span><span style=display:flex><span>0x00001000 0          qqq        666        0            0 
</span></span></code></pre></div><h4 id=信号量>信号量</h4><p>信号量本质上是个计数器，linux 内核有相应的数据结构来维护。</p><p>注意，这里操作的是信号量集合，信号量集合里面可以由一个或多个信号量。</p><p>示例代码：</p><ul><li>创建：<code>demo_c/demo_linux_c/ipc/semaphores/semget.c</code></li><li>控制：<code>demo_c/demo_linux_c/ipc/semaphores/semctl.c</code></li><li>操作：<code>demo_c/demo_linux_c/ipc/semaphores/semop.c</code></li></ul><p>创建有一个信号量的信号量集合：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./semget.elf
</span></span><span style=display:flex><span>[debug]:semId=0, errno=0, error=Success
</span></span></code></pre></div><p>信号量创建完成后，可以通过 ipcs 命令查看，通过 key 字段可以找到创建的信号量。
设置信号量后，nsems 字段对应信号量集中信号量的个数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ipcs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------ Semaphore Arrays --------
</span></span><span style=display:flex><span>key        semid      owner      perms      nsems     
</span></span><span style=display:flex><span>0x00001000 0          qqq        666        1 
</span></span></code></pre></div><p>设置和读取信号量集合里的信号量：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./semctl.elf
</span></span><span style=display:flex><span>[debug]:SETVAL, semctlResult=0
</span></span><span style=display:flex><span>[debug]:GETVAL, semctlResult=3
</span></span></code></pre></div><p>和消息队列的 msgctl 一样，信号量的 semctl 也有 IPC_STAT 、IPC_RMID 这两个参数，这里就不演示了。</p><p>操作信号量集合里的信号量：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./semop.elf
</span></span><span style=display:flex><span>[debug]:SETVAL, semctlResult=0
</span></span><span style=display:flex><span>[debug]:GETVAL, semctlResult=10
</span></span><span style=display:flex><span>[debug]:semopResult=0
</span></span><span style=display:flex><span>[debug]:GETVAL, semctlResult=8
</span></span></code></pre></div><p>一般最常用的信号量是二值信号量（0 和 1），用于进程间同步或是互斥操作。
二值信号量主要特点就是集合里只有一个信号量，并且信号量的值只有 0 和 1 这两个。</p><p>对信号量进行加 1 叫做 V（vrijgeven），对它进行减 1 操作叫做 P（passeren）。
和操作系统信号量的 pv 操作是一样的。二值信号量主要用于进程间同步，保证数据的一致性，对关键核心代码做临界，控制共享内存。</p><p>示例代码：<code>demo_c/demo-in-linux/ipc/semaphores/passeren_vrijgeven.c</code></p><h4 id=共享内存>共享内存</h4><p>申请一块内存，进程间通过关联这块内存从而达到进程间通信的目的，它是 IPC 进程间通信中最快的。</p><p>示例代码：</p><ul><li>创建：<code>demo_c/demo_linux_c/ipc/shared_memory/shmget.c</code></li><li>连接、写入：<code>demo_c/demo_linux_c/ipc/shared_memory/shmat.c</code></li><li>连接、读取、断开连接：<code>demo_c/demo_linux_c/ipc/shared_memory/shmdt.c</code></li></ul><p>创建共享内存：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./shmget.elf
</span></span><span style=display:flex><span>[debug]:shmId=2, errno=0, error=Success
</span></span></code></pre></div><p>共享内存创建完成后，可以通过 ipcs 命令查看，通过 key 字段可以找到创建的共享内存。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ipcs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>------ Shared Memory Segments --------
</span></span><span style=display:flex><span>key        shmid      owner      perms      bytes      nattch     status      
</span></span><span style=display:flex><span>0x00001000 2          qqq        666        1024       0 
</span></span></code></pre></div><p>连接共享内存、写入数据：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./shmat.elf
</span></span><span style=display:flex><span>[debug]:shmId=2, errno=0, error=Success
</span></span></code></pre></div><p>连接共享内存、读取数据、断开连接：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>&gt; ./shmdt.elf
</span></span><span style=display:flex><span>[debug]:shmId=2, errno=0, error=Success
</span></span><span style=display:flex><span>[info]:msg=hello
</span></span><span style=display:flex><span>[debug]:shmdtResult=0
</span></span></code></pre></div><h2 id=参考>参考</h2><ul><li>{CSDN}/{富贵的编程日记}/
<a href=https://blog.csdn.net/weixin_49730048/article/details/123595404 title="Linux快速入门之 管道（11）" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Linux快速入门之 管道（11）
<i class="fa fa-external-link-alt"></i></a></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/computer-science%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%a7%91%e5%ad%a6>computer-science(计算机科学)</a>
<a href=/tags/operating-system%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f>operating-system(操作系统)</a>
<a href=/tags/ipc%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1>ipc(进程间通信)</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
进程间通信（IPC）</li><li class=post-copyright-author><strong>本文作者：</strong>
西柊慧音</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=/post/computer-science/operating-system/linux/ipc/ title=进程间通信（IPC）>/post/computer-science/operating-system/linux/ipc/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/computer-science/operating-system/windows/hosts/ rel=next title="hosts 文件"><i class="fa fa-chevron-left"></i> hosts 文件</a></div><div class="post-nav-prev post-nav-item"><a href=/post/computer-science/operating-system/cmd_env_param/ rel=prev title=命令行参数和环境参数>命令行参数和环境参数
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>西柊慧音</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.103.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.1 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":false,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.c997eeae723f2fcee19ae5066fcc64a49cefb92ddb75904efdb69a223e5a6740.js defer></script></body></html>