<!doctype html><html lang=zh-cn data-theme=light><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.103.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="IP 协议"><meta itemprop=description content><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/image/pid49256268.jpg"><meta itemprop=keywords content="computer-science(计算机科学),network(网络),protocol(协议),ip"><meta property="og:type" content="article"><meta property="og:title" content="IP 协议"><meta property="og:description" content><meta property="og:image" content="/image/pid49256268.jpg"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/post/computer-science/protocol/ip/ip/"><meta property="og:site_name" content="帕里特档案馆"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="西柊慧音"><meta property="article:published_time" content="2022-05-04 08:00:00 +0800 CST"><meta property="article:modified_time" content="2022-05-04 08:00:00 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.4da9279b6033ade10d67092d7bfb660265f9fa46c40974f17b13bfe235396546.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"ip","permalink":"/post/computer-science/protocol/ip/ip/","title":"IP 协议","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>IP 协议 - 帕里特档案馆</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>帕里特档案馆</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>重建中</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>107</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><ul><li><a href=#ip>IP</a></li><li><a href=#网络层>网络层</a></li><li><a href=#ipv4>IPv4</a><ul><li><a href=#ipv4-地址>IPv4 地址</a></li><li><a href=#主机号全为-0-或-1>主机号全为 0 或 1</a></li><li><a href=#公有地址和私有地址>公有地址和私有地址</a></li><li><a href=#de-类地址>D、E 类地址</a></li><li><a href=#unicast单播broadcast广播multicast组播>unicast（单播）、broadcast（广播）、multicast（组播）</a></li><li><a href=#回环地址>回环地址</a></li><li><a href=#cidrclassless-inter-domain-routing无分类地址>CIDR（Classless Inter-Domain Routing、无分类地址）</a></li><li><a href=#ipv4-报文结构>IPv4 报文结构</a></li></ul></li><li><a href=#ipv6>IPv6</a><ul><li><a href=#ipv6-地址>IPv6 地址</a></li><li><a href=#ipv6-报文结构>IPv6 报文结构</a></li><li><a href=#ipv6-相比-ipv4-的优点>IPv6 相比 IPv4 的优点</a></li></ul></li><li><a href=#参考>参考</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=西柊慧音 src=/imgs/img-lazy-loading.gif data-src=/image/pid49256268.jpg><p class=site-author-name itemprop=name>西柊慧音</p><div class=site-description itemprop=description></div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>107</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>19</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>67</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/KelipuTe title="Github → https://github.com/KelipuTe" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=xhy_1365@sina.com title="E-Mail → xhy_1365@sina.com" rel=noopener class=hvr-icon-pulse target=_blank><i class="fa fa-envelope fa-fw hvr-icon"></i>E-Mail</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://gitee.com/hugo-next/hugo-theme-next title=https://gitee.com/hugo-next/hugo-theme-next target=_blank>Hugo-NexT</a></li><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/hugo-next rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/post/computer-science/protocol/ip/ip/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/image/pid49256268.jpg"><meta itemprop=name content="西柊慧音"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="西柊慧音"><meta itemprop=description content></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="IP 协议"><meta itemprop=description content="IP 协议；"></span><header class=post-header><h1 class=post-title itemprop="name headline">IP 协议</h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2022-05-04 08:00:00 +0800 CST" itemprop="dateCreated datePublished" datetime="2022-05-04 08:00:00 +0800 CST">2022-05-04</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/protocol%E5%8D%8F%E8%AE%AE itemprop=url rel=index><span itemprop=name>protocol(协议)</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>3741</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>8分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span id=busuanzi_value_page_pv data-path=/post/computer-science/protocol/ip/ip/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><h3 id=ip>IP</h3><p>IP（Internet Protocol、网际互连协议）根据端到端的设计原则，为主机提供一种无连接、不可靠的、尽力而为的数据包传输服务。</p><h3 id=网络层>网络层</h3><p>网络层的主要作用是实现主机与主机之间点对点的通信。网络层的通信只有两个主体，即两个主机。</p><p>网络层负责在没有实现直连的两个网络之间进行通信，数据链路层负责在实现直连的两个设备之间进行通信。即两个主机之间通过多个网络基础设施节点实现互联，数据链路层负责这些网络基础设施节点两两之间的通信。</p><p>在传输过程中源 IP 地址和目标 IP 地址在是不会变化的但是 MAC 地址，每经过一个基础设施节点就会变一次。</p><h3 id=ipv4>IPv4</h3><p>IPv4（Internet Protocol version 4、互联网通信协议第四版）由 IETF（The Internet Engineering Task Force、国际互联网工程任务组） 的 RFC 791 定义。</p><ul><li><a href=https://www.rfc-editor.org/rfc/rfc791 title=https://www.rfc-editor.org/rfc/rfc791 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.rfc-editor.org/rfc/rfc791
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://datatracker.ietf.org/doc/html/rfc791 title=https://datatracker.ietf.org/doc/html/rfc791 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://datatracker.ietf.org/doc/html/rfc791
<i class="fa fa-external-link-alt"></i></a></li></ul><h4 id=ipv4-地址>IPv4 地址</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>High Order Bits   Format                           Class
</span></span><span style=display:flex><span>---------------   -------------------------------  -----
</span></span><span style=display:flex><span>      0            7 bits of net, 24 bits of host    a
</span></span><span style=display:flex><span>      10          14 bits of net, 16 bits of host    b
</span></span><span style=display:flex><span>      110         21 bits of net,  8 bits of host    c
</span></span><span style=display:flex><span>      111         escape to extended addressing mode
</span></span></code></pre></div><p>IPv4 地址由 32 位二进制数表示，分为网络号和主机号。最多可以表示 $2^{32}$ 个主机。</p><h5 id=网络号>网络号</h5><p>IP 地址的网络号用于路由控制。</p><p>两台主机需要通信，首先需要判断在不在同一个网络内，即网络号是否一样。</p><ul><li>如果网络号相同，那说明双方在同一个网络内，可以把数据包直接发过去。</li><li>如果网络号不同，那说明双方不在同一个网络内，这时就需要路由器进行转发。</li></ul><p>路由器会维护一个路由表。路由表中记录着网络号对应的下一跳应该发送的地址。路由器在转发数据包时，首先从 IP 报文头部中获取目标地址，计算出网络号。然后从路由表中找到与该目标地址具有相同网络号的记录，将数据包转发给下一跳的地址。</p><p>如果路由表中存在多条相同网络号的记录，就选择与目标地址相同位数最多的记录。</p><h5 id=子网掩码>子网掩码</h5><p>子网掩码可以用来分离网络号和主机号。掩码的意思就是掩盖掉主机号，剩余的就是网络号。如 IP 地址 10.100.122.2，子网掩码 255.255.255.0。用 IP 地址和子网掩码作按位与运算，就可以得到网络号 10.100.122.0。</p><p>子网掩码的另一个作用是划分子网。子网划分将主机号再分为，子网网络号和子网主机号两部分。如 IP 地址 192.168.1.0，设置子网掩码为 255.255.255.192。可以将 8 位主机号分为 2 位子网网络号和 6 位子网主机号。</p><h5 id=点分十进制>点分十进制</h5><p>IPv4 地址可以写作点分十进制的形式。将 32 位二进制数，每 8 位分成一组，并转换为 10 进制数，中间用小数点连接。如地址 11000000 10101000 00000001 00000001 可写作 192.168.1.1。</p><p>各类 IPv4 地址的范围：</p><ul><li>A 类：0.0.0.0 ~ 127.255.255.255；</li><li>B 类：128.0.0.0 ~ 191.255.255.255；</li><li>C 类：192.0.0.0 ~ 223.255.255.255；</li><li>D 类：224.0.0.0 ~ 239.255.255.255；</li><li>E 类：240.0.0.0 ~ 255.255.255.255；</li></ul><h4 id=主机号全为-0-或-1>主机号全为 0 或 1</h4><p>对于 A、B、C 类地址，它们都有两个特殊的地址。</p><ul><li>主机号全为 0，指定某个网络，通常用在路由表中。</li><li>主机号全为 1，指定某个网络下的所有主机，通常用于广播。</li></ul><p>所以对于 A、B、C 类地址，可连接的最大主机数需要减 2。</p><p>广播就是向广播地址指定的网络中所有的主机发送数据包。广播地址可以分为local broadcast（本地广播）和 directed broadcast（直接广播）两种。</p><p>在本网络内广播的叫本地广播。比如主机 192.168.0.1 向 192.168.0.0/24 的广播地址 192.168.0.255 发送数据包。192.168.0.0/24 网络下的所有主机 192.168.0.2 ~ 192.168.0.254 都能收到数据包，而 192.168.0.0/24 之外的网络不会。</p><p>在不同网络之间广播的叫直接广播，比如主机 192.168.0.1/24 向 192.168.1.0/24 的广播地址 192.168.1.255 发送数据包。由于发送主机和目标广播地址不在一个网络中，所以数据包需要路由器进行转发。然后 192.168.1.0/24 网络下的所有主机 192.168.1.1 ~ 192.168.1.254 都能收到数据包。</p><h4 id=公有地址和私有地址>公有地址和私有地址</h4><p>对于 A、B、C 类地址，它们都有公有地址和私有地址的概念。</p><p>公有地址必须唯一，私有地址可以重复。比如两个公司各自的服务器的公有地址必须不一样，这样客户端才知道该访问哪台服务器。私有地址通常只在公司或组织内部使用，两个公司内部有私有地址相同并不会造成冲突。</p><p>公有地址由 ICANN（互联网名称与数字地址分配机构）管理。私有地址由各个公司或组织内部的 IT 人员自行管理。ICANN 下属的 IANA 负责按大洲，层层分配地址。中国地区的公有地址是由 IANA 下属的 APNIC 下属的 CNNIC 管理。</p><p>私有地址的范围：</p><ul><li>A 类：10.0.0.0 ~ 10.255.255.255；</li><li>B 类：172.16.0.0 ~ 172.32.255.255；</li><li>C 类：192.168.0.0 ~ 192.168.255.255；</li></ul><h4 id=de-类地址>D、E 类地址</h4><p>D、E 类地址没有主机号。D 类地址常用于组播（多播），E 类地址暂未使用。</p><p>组播用于将数据包发给特定组内的所有主机。广播无法穿透路由，广播只能给某一个网络下的所有主机发送数据包。如果想给处于不同网络中的一组主机发送同样的数据包就可以使用组播。</p><p>224.0.0.0 ~ 239.255.255.255 都是组播的可用范围，其划分为以下三类。</p><ul><li>224.0.0.0 ~ 224.0.0.255 为预留的组播地址，只能在局域网中使用，路由器不会进行转发。</li><li>224.0.1.0 ~ 238.255.255.255 为用户可用的组播地址，可用于 Internet。</li><li>239.0.0.0 ~ 239.255.255.255 为本地管理组播地址，可用于内网，仅在特定的本地范围内有效。</li></ul><h4 id=unicast单播broadcast广播multicast组播>unicast（单播）、broadcast（广播）、multicast（组播）</h4><h4 id=回环地址>回环地址</h4><p>回环地址是在同一台计算机上的程序之间进行网络通信时所使用的一个默认地址。</p><p>计算机使用 127.0.0.1 作为回环地址。当使用回环地址时，传输的数据包不会流向互联网。</p><p>主机名 localhost 与回环地址127.0.0.1 有相同意义。</p><h4 id=cidrclassless-inter-domain-routing无分类地址>CIDR（Classless Inter-Domain Routing、无分类地址）</h4><p>无分类地址不再有分类的概念，直接将 32 位 二进制数分为两部分。</p><p>前面是网络号，后面是主机号。如 192.168.0.0/24 ，表示网络号占 24 位。</p><h4 id=ipv4-报文结构>IPv4 报文结构</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>    0                   1                   2                   3
</span></span><span style=display:flex><span>    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |Version|  IHL  |Type of Service|          Total Length         |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |         Identification        |Flags|      Fragment Offset    |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |  Time to Live |    Protocol   |         Header Checksum       |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |                       Source Address                          |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |                    Destination Address                        |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |                    Options                    |    Padding    |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |                             data                              |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span></code></pre></div><ul><li>Version：版本号，4 bit</li><li>IHL：Internet Header Length、头部长度，4 bit</li><li>TOS：Type of Service、服务类型，8 bit</li><li>Total Length：总长度，16 bit</li><li>Identification：标识符，16 bit</li><li>Flags：标志，3 bit；</li><li>Fragment Offset：分片偏移，13 bit</li><li>TTL：Time To Live、生存时间，8 bit</li><li>Protocol：协议，8 bit</li><li>Header Checksum：头部校验和，16 bit</li><li>Source Address：源地址，32 bit</li><li>Destination Address：目标地址，32 bit</li><li>Option、Padding：选项和填充，长度可变</li><li>Data：数据，长度可变</li></ul><p>为了网络设备硬件设计和处理方便，首部长度需要是 4 字节的整数倍。</p><p>每种数据链路的最大传输单元（MTU）都是不同的，比如以太网的 MTU 是 1500 字节。
当 IP 数据包的大小大于 MTU 时，数据包就会被分片。经过分片后的 IP 数据报只能由目标主机进行重组。</p><p>在进行分片传输时，一旦某个分片丢失，那么整个 IP 数据包就无效了，需要全部重传。
TCP 引入了 MSS，数据在 TCP 层进行分包，不交给 IP 层分片。UDP 尽量不要发送超过 MTU 的数据包。</p><h3 id=ipv6>IPv6</h3><p>IPv6（Internet Protocol version 6、互联网通信协议第 6 版）由 IETF（The Internet Engineering Task Force、国际互联网工程任务组） 的 RFC 2460 定义。</p><ul><li><a href=https://www.rfc-editor.org/rfc/rfc2460 title=https://www.rfc-editor.org/rfc/rfc2460 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.rfc-editor.org/rfc/rfc2460
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://datatracker.ietf.org/doc/html/rfc2460 title=https://datatracker.ietf.org/doc/html/rfc2460 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://datatracker.ietf.org/doc/html/rfc2460
<i class="fa fa-external-link-alt"></i></a></li></ul><h4 id=ipv6-地址>IPv6 地址</h4><p>IPv6 地址由 128 位二进制数表示。最多可以表示 $2^{128}$ 个主机。</p><p>IPv6 地址可以写作 16 进制的形式。将 128 位二进制数，每 16 位分成一组，并转换为 16 进制数，中间用冒号连接。二进制：<code>16 位 : 16 位 : 16 位 : 16 位 : 16 位 : 16 位 : 16 位 : 16 位</code>。可写作：<code>4 位 : 4 位 : 4 位 : 4 位 : 4 位 : 4 位 : 4 位 : 4 位</code>。</p><p>连续的 0 可以用两个冒号表示，但是每个地址中只能出现一次。如：<code>4 位 : 0000 : 0000 : 0000 : 0000 : 0000 : 0000 : 4 位</code> 可写作 <code>4 位 :: 4 位</code></p><ul><li>IPv6 没有广播地址。</li><li>单播地址用于一对一通信。</li><li>组播地址用于一对多通信。</li><li>任播地址用于通信最近的节点，最近的节点由路由协议决定。</li></ul><p>单播地址主要分为三类：</p><ul><li>在同一链路里，不经过路由器，使用链路本地单播地址。</li><li>在内网里，使用唯一本地地址，相当于 IPv4 的私有 IP。</li><li>在互联网上，使用全局单播地址，相当于 IPv4 的公有 IP。</li></ul><h4 id=ipv6-报文结构>IPv6 报文结构</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>    0                   1                   2                   3
</span></span><span style=display:flex><span>    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |Version| Traffic Class |           Flow Label                  |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |         Payload Length        |  Next Header  |   Hop Limit   |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +                                                               +
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +                         Source Address                        +
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +                                                               +
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +                                                               +
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +                      Destination Address                      +
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +                                                               +
</span></span><span style=display:flex><span>   |                                                               |
</span></span><span style=display:flex><span>   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</span></span></code></pre></div><ul><li>Version：版本号，4 bit</li><li>Traffic Class：流量类型，8 bit</li><li>Flow Label：流量标记，20 bit</li><li>Payload Length：有效载荷长度，16 bit</li><li>Next Header：下一个报头，8 bit</li><li>Hot limit：跳数限制，8 bit</li><li>Source Address：源地址，128 bit</li><li>Destination Address：目标地址，128 bit</li></ul><p>$Payload Length = 报头后的数据长度 + 扩展头部数据长度$</p><p>扩展头部可以有多个。IPv6 头部的 Next Header 存储第一个扩展头部的位置。第一个扩展头部的 Next Header 存储的是第二个扩展头部的位置。</p><ul><li>IPv6 取消了首部校验和字段。IPv4 中这个字段在数据链路层和传输层都会校验，IPv6 直接取消校验。</li><li>IPv6 取消了分片和重组相关字段。分片和重组很耗时，IPv6 不允许中间路由器进行分片与重组。</li><li>IPv6 取消选项字段。IPv6 中选项字段并没有消失，而是放在扩展头部中。</li></ul><h4 id=ipv6-相比-ipv4-的优点>IPv6 相比 IPv4 的优点</h4><ul><li>IPv6 首部长度固定为 40 个字节，去掉了包头校验，简化了首部结构，从而减轻路由器负荷，提高传输性能。</li><li>IPv6 不需要 DHCP 服务器也可以实现自动分配 IP 地址。</li><li>IPv6 有应对伪造 IP 地址的网络安全功能以及防止线路窃听的功能，提高了安全性。</li><li>&mldr;</li></ul><h3 id=参考>参考</h3><ul><li><a href=https://www.rfc-editor.org/rfc/rfc791 title=https://www.rfc-editor.org/rfc/rfc791 rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://www.rfc-editor.org/rfc/rfc791
<i class="fa fa-external-link-alt"></i></a></li><li><a href=https://xiaolincoding.com/ title=小林coding rel="noopener external nofollow noreferrer" target=_blank class=exturl>小林coding
<i class="fa fa-external-link-alt"></i></a><ul><li><a href=https://xiaolincoding.com/network/ title=图解网络 rel="noopener external nofollow noreferrer" target=_blank class=exturl>图解网络
<i class="fa fa-external-link-alt"></i></a></li></ul></li></ul></div><footer class=post-footer><div class=post-tags><a href=/tags/computer-science%e8%ae%a1%e7%ae%97%e6%9c%ba%e7%a7%91%e5%ad%a6>computer-science(计算机科学)</a>
<a href=/tags/network%e7%bd%91%e7%bb%9c>network(网络)</a>
<a href=/tags/protocol%e5%8d%8f%e8%ae%ae>protocol(协议)</a>
<a href=/tags/ip>ip</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
IP 协议</li><li class=post-copyright-author><strong>本文作者：</strong>
西柊慧音</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=/post/computer-science/protocol/ip/ip/ title="IP 协议">/post/computer-science/protocol/ip/ip/</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/computer-science/protocol/http/https/ rel=next title=HTTPS><i class="fa fa-chevron-left"></i> HTTPS</a></div><div class="post-nav-prev post-nav-item"><a href=/post/computer-science/protocol/ip/related-technology/ rel=prev title="和 IP 相关的玩意，暂时放这里">和 IP 相关的玩意，暂时放这里
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2020 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>西柊慧音</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.103.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.4.1 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"busuanzi":{"pageview":true},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":false,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.c997eeae723f2fcee19ae5066fcc64a49cefb92ddb75904efdb69a223e5a6740.js defer></script></body></html>