---
draft: false
title: "分布式系统 CAP 问题"
summary: "分布式系统 CAP 问题；"
toc: true

categories:
  - 架构

tags:
  - 计算机
  - 架构

date: 2024-03-19 08:00:00 +0800
---

## 正文

### 分布式系统 CAP 问题

- 一致性（consistency）：系统在执行过某项操作后，仍然处于一致的状态。
  比如，一台服务器执行过更新操作后，所有的服务器拿到的都是最新的值。
- 可用性（availability）：每个操作总是能够在可以容忍的时间内得到结果。
  得到结果就行，结果可以是成功，也可以是失败，重点是得到结果。
- 分区容错性（partition-tolerance）：存在网络分区的情况下，仍然可以接受请求。

分布式系统中的节点组成的网络应该是连通的。但是因为一些原因，有些节点之间不连通了。
这样整个网络就分成了几块区域，而数据散布在了这些不连通的区域中。这就是网络分区。

在分布式系统中，一致性、可用性、分区容错性，三个最多同时满足两个。

如果某个数据只在网络中的某个节点中保存。
那么网络分区出现后，和这个节点不连通的区域就访问不到这个数据了。
提高分区容错性的办法就是将这个数据复制到多个节点上，复制操作会带来一致性的问题。
如果要保证一致性，那么每次写操作就要等待全部节点都写成功，这会带来可用性的问题。

### 选 CP 还是 AP

分区容错性是一定要保证的。由于网络硬件肯定会出现延迟丢包等问题。
想要避免分区容错性就意味着单体部属，单体部属一定严重影响系统的扩展性。
所以只能在一致性和可用性之间进行权衡。

选择一致性（CP）。
遇到分区容错性故障时，服务要一直等到节点间的网络重新连通。
在等待期间，系统无法对外提供服务。因此可用性受影响。

选择可用性（AP）。
遇到分区容错性故障时，继续提供服务，这会导致几块区域中的数据不一致。
因此一致性受影响。等到节点间的网络重新连上后，数据就会恢复一致性。
AP 不是完全放弃数据一致性，而是放弃数据的强一致性，保留数据的最终一致性。

## 参考

- [分布式系统的CAP定理详解](https://zhuanlan.zhihu.com/p/335617791)
