---
draft: false
title: "微服务"
summary: "微服务；"
toc: true

categories:
  - 架构

tags:
  - 计算机
  - 架构

date: 2024-03-26 08:00:00 +0800
---

## 正文

### 高可用

高可用一般指可用性达到 99.9%。

基本思路主要有：
- 容错：冗余、负载均衡、熔断、限流、降级、超时控制。
- 观测系统、告警系统、故障自动处理机制、人工介入的入口。
- 限制故障影响范围：隔离（服务解耦，基础设施隔离）。
- 规范变更（上线）流程：代码上线、配置变更、回滚准备。

### 高可用方案

高可用方案是一个从前端到后端的完整方案。

- 面向用户的接口有没有限流等措施预防攻击。
- 后端有没有用集群，选择的负载均衡算法是否合适。
- 后端有没有熔断、限流、降级、超时控制等治理措施。
- 后端依赖的组件（redis、mysql、mq）有没有高可用。
- 前后端依赖的第三方服务访问不了了怎么办。
- 变更（上线）流程里面有没有风险点。

做方案的具体步骤一般是：发现问题、计划方案、落地实施、取得效果、后续改进。

### 几个好用的方案

#### 同步转异步

对于一个请求来说：多做多错，少做少错，不做不错。

所以可以考虑，同步转异步的思路。将服务之间解耦，能用异步就用异步。同步失败了就失败了，回滚数据也很麻烦；异步失败了还可以重试，回滚数据也比较容易。

#### 故障自动处理机制

自动扩容：观测系统+负载均衡

这里不一定非要部署新的机器。预算不够的话，可以在一台机器上准备好两三个服务的代码跑着，但是不给流量。等哪个服务的压力上来了，就调整负载均衡，放流量进来，压力下去了就移除流量。

自动修复数据：定时任务+自动修复+告警

通过定时任务定期对比数据或者核验数据。如果数据不一致或者数据的状态不对。先调用自动修复的代码，然后重新对比数据或者核验数据。如果任然失败就触发告警，让人工介入。
