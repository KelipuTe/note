---
draft: true
date: 2022-08-01 08:00:00 +0800
title: "虚拟内存"
summary: "虚拟内存；"
toc: true

categories:
  - 操作系统

tags:
  - 计算机科学
  - 操作系统
  - 内存
---

## 正文

### 虚拟内存

单片机的 CPU 可以直接操作物理内存。但是，在这种情况下是无法同时运行多个程序的。
如果多个程序都操作了同一个物理内存地址，那么多个程序之间就会互相影响，最终导致程序崩溃。

[可寻址内存](/计算机/硬件/可寻址内存)

操作系统使用虚拟内存（Virtual Memory）将进程与物理内存进行隔离，操作系统为每个进程独立分配一套虚拟内存。
进程操作虚拟内存的时候，操作系统会将虚拟内存地址转换到物理内存地址，这样多个进程之间就互不干涉。

操作系统会防止某个进程去访问不是操作系统配置给它的寻址空间，这个机制叫内存保护（memory protection）。
内存保护可以防止某个进程，因为某些程序错误或问题，而有意或无意地影响到其他进程或是操作系统本身的运行状态和数据。

虚拟内存地址和物理内存地址的映射由操作系统为进程提供，进程不需要管数据到底存在哪块物理内存上。
进程使用的虚拟地址，会通过 CPU 芯片中的内存管理单元（Memory Management Unit、MMU）的映射关系来转换变成物理地址，然后再通过物理地址访问内存。

- 虚拟内存地址（virtual memory address）：程序使用的内存地址
- 物理内存地址（physical memory address）：硬件里面的内存地址

因为程序运行符合局部性原理，不是所有的内存都是同时在使用的。所以虚拟内存可以使得进程的运行内存超过物理内存的大小。

[局部性原理](/计算机/局部性原理)

操作系统主要有两种管理内存的方式：内存分段（Segmentation）和内存分页（Paging）。

[段式管理](/计算机/operating-system/段式管理)

[页式管理](/计算机/operating-system/页式管理)

[段页式管理](/计算机/operating-system/段页式管理)

动态内存分配（Dynamic Memory Allocation）是指，在程序运行的过程中，动态地分配或者回收内存空间。
动态内存分配不需要预先分配存储空间，而是操作系统根据程序的需要即时分配，而且分配的大小就是程序要求的大小。
