---
draft: false
date: 2023-03-25 08:00:00 +0800
title: "网络"
summary: "网络；局域网；以太网；MAC；交换机；冲突域；路由；分组交换；互联网；DNS；网络分层模型；万维网；"
toc: true

categories:
  - 网络

tags:
  - 计算机
  - 网络
---

## 资料

图：./网络.drawio

## 正文

### 计算机网络

计算机一开始的时候和网络并不是密切相关的。网络这种结构很早以前就出现了。
比如，古代的驿站体系、近代的情报系统等，都是靠人、牲畜、载具搭建起来的。

计算机一开始出现的时候，都是独立存在的大型机器。
后来，随着计算机的发展，在计算机之间分享数据和资源渐渐变得有用起来。随即，计算机网络出现了。

### 局域网

计算机网络刚开始的时候，是几台距离很近的计算机，
通过电缆连起来之后，一起分享物理资源（比如，存储器和打印机）。
要不然，需要把存储器（纸卡、磁带）搬来搬去，很麻烦。

**见图：网络.drawio**。

这种由计算机近距离构成的小型网络就是局域网（local area network、LAN）了。
局域网可以是小到同一个房间里的两台机器，或者大到一个区域内的成百上千台机器。

### 以太网

局域网里如果只有两台机器那还好说，一对一通信，没有歧义。
但是如果是两台以上的机器，它们之间通过电缆连起来之后，怎么进行通信呢？
电缆上的电信号是没有指向的，只要有计算机将数据发送到电缆上，那么所有的计算机都能收到。

#### MAC

假设，现在一个局域网里有 4 台计算机（a、b、c、d）。

**见图：网络.drawio**。

a 想将数据发送给 d。这个时候，a 向电缆上发送了数据。
那么 b、c、d 都能识别到电信号，也就是都能接收到一样的数据。
问题来了，b 和 c 怎么知道数据不是给自己的，d 怎么知道数据是给自己的。

这里就需要用到以太网（ethernet）了。
为了解决这个问题，以太网规定，每台计算机都有唯一的 MAC 地址（media access control address、媒体访问控制地址）。
把这个地址放在要传输的数据的最前面，这样网络中的每一台计算机接收到数据后，就可以知道这个数据是不是发给自己的。

类似这种多台计算机共享同一个传输媒介的方法叫载波侦听多路访问（carrier sense multiple access、CSMA）。
载体（carrier）指的是运输数据的媒介，以太网用的是电缆，WiFi 用的是空气。
多个计算机同时在检测载体中的信号，所以叫多路访问和侦听。

#### 冲突

用共享载体有一个很大的弊端，整个网络上同一时间只能有一台计算机发送信息。
如果有多个计算机同时发送信息，电信号就要打起来了，这叫冲突。
随着网络中计算机变多，这种情况出现的概率也会变高。

为了防止出现冲突，计算机可以先检测网络中是不是有数据，如果有那就停止传输，等待网络空闲下来，然后再次尝试。
问题在于，别的计算机也会这么做，冲突依然不可避免。

以太网解决这个问题的方式是，如果检测到冲突，就会在再次尝试之前等待一段时间。
等待时间由一个设置好的时间间隔和一个随机时间组成。

如果时间到了再次尝试依然检测到冲突，那么意味着网络处于拥塞状态。这个时候，等待时间的时间间隔会翻倍。
如果时间到了再次尝试依然检测到冲突，那么等待时间的时间间隔会继续翻倍，直到成功传输。
这种以指数增长的等待方式叫指数退避（exponential backoff）。

### 交换机

尽管以太网可以一定程度上解决冲突的问题，但是如果所有的计算机都连接在同一个载体上，那冲突问题依然还是很严重的。
为了减少冲突，提升效率，就需要减少同一载体中设备的数量。交换机（switch）就是干这个的。

#### 冲突域

载体和连接在载体上的设备构成一个冲突域（collision domain）。

上文的 4 台计算机（a、b、c、d）和连接它们的载体构成了一个冲突域。
为了减少冲突，可以使用交换机把它拆成两个冲突域。

**见图：网络.drawio**。

交换机位于两个网络之间，只有在必要时才在两个网络间传递数据。

假设，a 和 b 一个冲突域，c 和 d 一个冲突域。
a 将数据发送给 b 的时候，交换机不会把数据发送给 c 和 d 所在的网络。
也就是说，这个时候 c 和 d 所在的网络依然是空闲的。
这样，c 就可以在同一时间将数据发送给 d。

如果是 a 将数据发送给 d 的场景。
这个时候，交换机就会把数据发送给 c 和 d 所在的网络，这个时候两个网络都处于被占用的状态。
就和上文 a、b、c、d 在一个冲突域中是等价的。

### 路由

#### 电路交换

想连接两台相隔遥远的计算机或者网络，最简单的办法是分配一条专用的通信线路。
早期的电话系统就是这样运作的，这种方式叫电路交换（circuit switching），是直接用电路把两者连接起来。

这种方式用到是能用，但是，对于普通的通信需求来说，为每一对计算机或者网络都铺设专门的线路，价格过于昂贵。
而且总有线路处于空闲状态，太浪费。除非真的有需要铺设专线进行通信的需求。

#### 报文交换

另一种传输数据的方式是报文交换（message switching）。它的运行方式有点像邮政系统。
两个设备之间的线路上会有多个类似站点的东西，每个站点都知道数据的下一站需要发到哪里。

**见图：网络.drawio**。

计算机连成网络之后，两个点之间通常会有不止一条路线，这些不同的路线就叫路由（routing）。
报文交换的好处是，有多个不同的路由可以使用，这样相比较专线而言，可靠程度更高。

消息沿着路由跳转的次数叫跳数（hop count）。
跳数可以记录到消息里面，用于判断路由有没有出现问题。
因为在网状的结构中，有可能出现环形结构或者消息在两个路由器之间来回传递。
如果某条消息的跳数很高，那么路由肯定哪里出问题了。

报文交换的站点一次只能传递一个消息，如果消息很大，那就有可能堵塞网络。
后面的消息，要么等待前面的大消息传完，要么选择另一条效率稍低的路由。

#### 分组交换

分组交换（packet switching）可以解决报文交换的网络被大消息堵塞的问题。

分组交换将整个消息分成很多的小块，叫数据包（packet），每个数据包都需要包含目标地址（目标的位置）。
这种消息的格式由网际互连协议（IP、internet protocol）定义。
IP 协议规定，每台计算机都需要一个 IP 地址。这样，路由器（站点）就可以知道需要将数据包发到哪里去。

路由器还会平衡与其他路由器之间的负载，如果有一个大消息，可能会造成单挑路由阻塞，那就可以通过多个路由进行发送。

**见图：网络.drawio**。

这也叫拥塞控制（congestion control），可以保证网络传输的可靠性和速率。

#### 去中心化

报文交换和分组交换这样的网状结构就是去中心化（decentralization）的结构，网络中的两个点之间存在多条路由。
如果一条路由因为某些原因失效了，也可以使用别的路由继续进行消息的传输。

### 互联网

想接入互联网，首先需要和互联网服务商（internet service provider、ISP）打交道。
比如，去中国电信办理一个宽带服务。然后工作人员会上门安装一个光猫，通过光猫就可以接入互联网了。
如果家里有多台设备需要上网的话，还需要安装一个路由器。这个路由器连接的家里的所有的设备构成了一个局域网。

然后，路由器通过光猫再连接到广域网（wide area network、WAN）。广域网也有路由器，它们一般属于互联网服务商。
在广域网里，会先连接到一个区域性路由器，这个路由器可能覆盖一个小区或者一个街道。然后，再连接到一个更大的广域网，可能覆盖一个城市。

可能再跳几次，最终到达互联网主干。互联网主干由一群超大型、超高带宽的路由器组成。
在 Linux 或者 Windows 操作系统中可以使用 traceroute 命令来看网络跳了几次。

比如，在 Windows 的 Power Shell 里面用 tracert 命令，跟踪一下 www.baidu.com 的访问过程。

```
> tracert www.baidu.com

通过最多 30 个跃点跟踪
到 www.a.shifen.com [180.101.50.242] 的路由:

  1     1 ms    <1 毫秒   <1 毫秒 XiaoQiang [192.168.31.1]
  2     3 ms     1 ms     1 ms  192.168.1.1
  3     9 ms     7 ms    11 ms  100.65.0.1
  4     4 ms     7 ms     7 ms  61.152.5.173
  5     *        *        *     请求超时。
  6     *        *        9 ms  202.97.72.206
  7    10 ms    88 ms     9 ms  58.213.95.26
  8     *        *        *     请求超时。
  9    11 ms    10 ms    10 ms  58.213.96.66
 10     *        *        *     请求超时。
 11     *        *        *     请求超时。
 12     *        *        *     请求超时。
 13    11 ms     9 ms     9 ms  180.101.50.242

跟踪完成。
```

### 数据包是如何传输的

上文提到，数据包里有 IP 地址。IP 协议负责把数据包送到正确的计算机。
但是，计算机上同时在运行的程序一般不止一个。计算机收到数据包后，应该交给那个程序呢？

因此，需要在 IP 协议之上，开发更高级的协议。
比如，TCP（transmission control protocol、传输控制协议）和 UDP（user datagram protocol、用户数据报协议）。
TCP 和 UDP 规定，数据包里还需要有端口号。

每个想访问网络的程序都需要向操作系统申请一个端口号。
这样，操作系统在接收到数据包之后，就可以根据端口号，把数据包送到正确的程序。

### 域名系统

数据包是通过 IP 地址和端口号进行传输的。但是，在使用浏览器时，输入的并不是 IP 地址，而是网址（域名）。
这个功能由域名系统（domain name system、DNS）提供，它负责把域名和 IP 地址一一对应。

当在浏览器里输入一个网址的时候，会先去 DNS 服务器找这个网址对应的 IP 地址。
DNS 服务器一般由互联网服务商提供。如果网址有效，则会返回 IP 地址。如果网址无效，则会返回 DNS 解析错误。

域名的数量是非常多的，用一个超长的列表存储全部的域名和对应的 IP 地址是不合适的，DNS 用的是树状结构。
最上面是顶级域名，顶级域名下面是二级域名，二级域名下面是子域名。
这样，数据就可以散布在很多的 DNS 服务器上，不同的服务器负责树的不同部分。

### 网络分层模型

这里主要讨论 4 层的 TCP/IP 网络模型，它是常见的网络分层模型的一种。
TCP/IP 网络模型的 4 层 "从上到下" 分别是，应用层、传输层、网络层、数据链路层（网络接口层）。
应用层上面，面向的是各种用户，数据链路层下面，面向的是物理结构。

应用层，各种用户使用的各种应用软件都是在应用层实现的。
当两个设备上的应用需要进行通信的时候，应用就会把需要传递的数据交给传输层，
由传输层完成数据的传输工作，应用层不需要关心数据是如何传输的。

这就类似于，位于两地的人（比如，人 a 和 人 b）需要进行交流的时候，只需要写封信，然后，交给邮递员。
由邮政系统完成信的邮递工作，写信的人是不需要关心信是怎么被邮递过去的。

TCP 和 UDP 位于传输层。IP 位于网络层。

### 万维网

万维网（world wide web、WWW）可以用浏览器来访问，它运行在互联网之上，和互联网是不同的东西。
在计算机组成的网络中，互联网是传输数据的工具，二万维网是其中传输数据最多的程序。

万维网的最基本的单位是单个页面。页面上有内容，也有其他页面的链接，这些链接也叫超链接（hyperlink）。
这些超链接形成巨大的互联网络，这也是万维网名字的由来。

没有超链接的时候，想要访问某个文件，需要准确地知道这个文件在计算机的哪个目录下面。
有了超链接之后，为了使网页能互相连接，每个网页需要一个唯一的地址，这地址就是统一资源定位器（uniform resource locator、URL）。

如果网页的数据只有纯文本，那么是无法表明什么是链接什么不是链接的，
所以需要定义一套规则来进行标记，这就是超文本标记语言（hypertext mark-up language、HTML）。
随之一起的，还有基于 TCP 协议开发的超文本传输协议（hyper text transfer protocol、HTTP）。

## 正向链接

[网络安全](/计算机/网络/网络安全)；
