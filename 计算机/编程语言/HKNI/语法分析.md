---
draft: false
title: "HKNI 的语法分析"
summary: "HKNI 解释型强类型语言的语法分析；"
toc: true

categories:
  - 编程语言

tags:
  - 计算机
  - 编程语言

date: 2024-03-04 08:00:00 +0800
---

## 正文

词法分析，我们把输入的文本打好了标记
语法分析就是分析这些标记好的文本之间有什么样的关系。

一整个程序是由内部的一条一条语句组成的。
这里需要先对程序中的元素进行抽象。
显而易见的，程序算一个、每块语句算一个。
为什么是每块呢，因为除了一条一条的语句，还有选择语句（if）、循环语句（for）、方法定义（func）这样一整块的。

```
var a int;
var b int = 5;
var c int = 5+5;
a = b+c;
```

上面这几条语句，主体结构是差不多的，
操作符右边可以变成各种东西，变量名既可以放在操作符左边也可以放在操作符右边，
这些东西本质上应该是一类，所以这里还有一个抽象，一般叫它表达式。

变量就是标识符表达式，数字就是数字表达式或者运算表达式。
为了解决四则运算的问题，这里还涉及到前缀表达式和中缀表达式的概念。

前缀表达式和中缀表达式后面还可以扩展，
比如 函数调用 `print("hello world");` 可以看做一个中缀表达式，中缀符号是 `(`

语句和表达式各自又分出好多种具体的形态。下面慢慢讲。

语法分析最终的产物就是程序的 AST 抽象语法树。

HKNI 采用的是基于运算符优先的语法分析方式。
那么首先就需要定义运算符的优先级。HKNI 是用 C++ 编写的，这里直接用 C++ 的运算符优先级。
优先级顺序是从高到低，这里只有 HKNI 用到的运算符。

| HKNI 的运算符优先级，从高到低           |
|-----------------------------|
| `()` 算数运算、函数；`[]` 数组；       |
| `-` 负号；`++`；`--`；`!` 逻辑运算非； |
| `*`；`/`；`%`；                |
| `+`；`-`；                    |
| `<`；`<=`；`>`；`>=`；          |
| `==`；`!=`；                  |
| `&` 位运算与；                   |
| `\|` 位运算或；                  |
| `&&` 逻辑运算与；                 |
| `\|\|` 逻辑运算或；               |
| `=` 赋值；                     |

##  

进行语法分析的时候，按语句结构一块一块的分析。token 指针的位置，不要少也不要多。
这样一方面可以让代码比较方便的被复用，另一方面也方便语法分析出错的时候定位问题。
如果所谓的不要写重复的代码会破坏模块的独立性，那不管也罢，cccv 就 cccv，代码逻辑清晰放在第一位。

## 四则运算和小括号

这里用 $1+2*3$ 和 $(1+2)*3$ 举例。
没有括号的时候，`+` 的优先级小于 `*` 的优先级，会继续解析，先返回的是 $2*3$。
有括号的时候，括号在解析过程中，起到隔离的作用，`)` 把 $1+2$ 和 `*` 隔开了，先返回的是 $1+2$。
