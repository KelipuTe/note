---
draft: false
title: "HKNI 的词法分析"
summary: "HKNI 解释型强类型语言的词法分析；"
toc: true

categories:
  - 编程语言

tags:
  - 计算机
  - 编程语言

date: 2024-03-02 08:00:00 +0800
---

## 正文

首先需要定义 HKNI 的语法。
简单理解就是，编程语言提供哪些功能，这些功能对应的代码要怎么编写。
有了语法定义之后，就可以从里面得到词法标记。

### 语法定义

语句必须以分号结尾。

#### 数据类型

空（null）。

```
null;
```

整数（int）。支持：二进制（0b）、八进制（0）、十进制、十六进制（0x）。

```
0b10;
010;
10;
0x10;
```

浮点数（float）。支持：十进制。

```
3.14;
```

布尔值（bool）。支持：true、false。

```
true;
false;
```

字符串（string）。支持：''、""、``。支持转义字符。

```
"a"; //a
"ab"; //ab
"a'b'"; //a'b'
"a\"b\""; //a"b"
"a\\b"; //a\b
"a\\nb"; //a\nb
```

#### 运算

算数运算符。支持：负号（-）、加（+）、减（-）、乘（*）、除（/）、取余（%）。

```
-2;
2+2;2-2;
2*2;2/2;
2%2;
2+2*2;
```

通过小括号（()）改变优先级、前缀自增运算符（++）、前缀自减运算符（--）。

```
(2+2)*2;
++i;--i;
```

位运算符。支持：按位与（&）、按位或（|）。

```
0b10 & 0b11;
0b10 | 0b11;
```

逻辑运算符。支持：与（&&）、或（||）、非（!）。

```
true && false;
a && b;
true || false;
a || b;
!true;
!a;
```

关系运算符。支持：等于（==）、不等于（!=）、大于（>）、大于等于（>=）、小于（<）、小于等于（<=）。

```
2 == 2;a == 2;a == b;
2 != 2;a == 2;a == b;
2 >  2;a >  2;a >  b;
2 >= 2;a >= 2;a >= b;
2 <  2;a <  2;a <  b;
2 <= 2;a <= 2;a <= b;
```

#### 变量声明

```
var 标识符 类型;
```

```
var a int;
```

#### 赋值运算

赋值运算符。支持：=、+=、-=、*=、/=、%=。

```
标识符 赋值运算符 值;
```

```
a = 2;a = b;
```

#### 变量声明并赋值

```
var 标识符 类型 = 值; 
```

```
var a int = 2;
```

#### 常量声明

```
const 标识符 类型 = 值;
```

```
const a int = 2;
```

#### 选择结构

```
if (条件表达式) {块语句} else {块语句}

```

```
//只有 if 分支。
if (a == 2) {
    b = 10;
}
//有 if 分支和 else 分支。
if (a == 2) {
    b = 10;
} else {
    b = 20;
} 
```

#### 循环结构

```
for (初始化表达式;循环条件表达式;循环后操作表达式) {块语句}
```

```
//初始化表达式中没声明新变量。
var i int;
var j int = 2;
for (i = 0;i < 10;++i) {
    j+=2;
}

//初始化表达式中有声明新变量。
var j int = 2;
for (var int i = 0;i < 10;++i) {
    j+=2;
}
```

#### 函数（方法）声明

```
func 标识符(参数表) 返回值类型 {块语句}
参数表 => 标识符 类型, 标识符 类型...
```

```
func f() {} //没有入参，没有返回值。
func f(a int) {} //有入参，没有返回值。
func f(a int, b int) {} //有 2 个入参，没有返回值。
func f() int {} //没有入参，有返回值。
func f(a int) int {} //有入参，有返回值。
```

#### 函数（方法）调用

```
标识符(参数表);
```

```
f();
f(1);f(1,2);
f(a);f(a,b);
f(g());f(g(),b());
f(1,a,g());
```

#### 返回

```
return 值;
```

```
return;
return 2;return 2+2;
return a;return a+b;
return f();return f()+g();
```

#### 内置函数

```
println("hello world") //调用 c++ 的 std::cout
```

#### 结构体声明

```
type 结构体标识符 struct {具体定义}
具体定义：字段1标识符 字段1类型, 字段2标识符 字段2类型,...
```

```
function (结构体标识符) 函数标识符(参数列表){块语句}
参数列表：参数1标识符 参数2类型, 参数2标识符 参数2类型,...
```

#### 结构体实例化

```
结构体标识符 标识符 = new 结构体标识符{};
```

#### 数组

```
var 标识符 类型[数组长度];
```

里面是用 c++ 的 std::map 实现的。

#### map

```
var 标识符 map[键类型]值类型;
```

里面是用 c++ 的 std::map 实现的。

### 词法标记

从上述的语法定义中，就可以得到词法标记或者叫单词（token）。
主要有这几种：各种运算符、关键字、标识符、数字。

HKNI 采用的是基于运算符优先的语法分析方式。
所以识别的时候优先识别运算符，如果遇到引号就识别字符串。
如果不是这两个，那就是关键字、标识符、数字。

HKNI 所有的词法标记如下。
HKNI 是用 C++ 编写的，避开一些常见的关键字。

```
//词法标记类型，避开一些常见的关键字
enum TokenType {
    ILLEGAL, //非法，枚举第一个是0，正好用非法占位
    END, //结束

    //运算符（按键盘从左到右从上到下的顺序排的，方便找）
    STRING_VALUE, //字符串值（`、'、"）
    NOT, //逻辑非（!）
    NEQ, //不等于（!=）
    MOD, //取模（%）
    MOD_ASSIGN, //取模赋值（%=）
    BIT_AND, //位与（&）
    AND, //逻辑与（&&）
    MUL, //乘法（*）
    MUL_ASSIGN, //乘赋值（*=）
    LPAREN, //左括号（(）
    RPAREN, //右括号（)）
    SUB, //减法，负号（-）
    SUB_ASSIGN, //减赋值（-=）
    DEC, //自减（--）
    ASSIGN, //赋值（=）
    EQ, //等于（==）
    ADD, //加法（+）
    ADD_ASSIGN, //加赋值（+=）
    INC, //自增（++）
    LBRACKET, //左中括号（[）
    LBRACE, //左大括号（{）
    RBRACKET, //右中括号（]）
    RBRACE, //右大括号（}）
    BIT_OR, //位或（|）
    OR, //逻辑或（||）
    SEMICOLON, //分号（;）
    COLON, //冒号（:）
    COMMA, //逗号（,）
    LT, //小于（<）
    LTE, //小于等于（<=）
    GT, //大于（>）
    DOT, //点，用于类调用属性和方法（.）
    GTE, //大于等于（>=）
    DIV, //除法（/）
    DIV_ASSIGN, //除赋值（/=）
    COMMENT, //注释（//）

    //关键字
    NULL_HKNI, //null值（null）
    BOOL_VALUE, //布尔值（true、false）
    BOOL_TYPE, //布尔类型（bool）
    INT_VALUE, //整数值（2进制、8进制、10进制、16进制）
    INT_TYPE, //整数类型（int）
    FLOAT_VALUE, //浮点数值（10进制）
    FLOAT_TYPE, //浮点数类型（float）
    STRING_TYPE, //字符串类型（string）
    VAR_HKNI, //变量声明（var）
    CONST_HKNI, //常量声明（const）
    IF_HKNI, //if语句
    ELSE_HKNI, //else语句
    FOR_HKNI, //for循环语句
    FUNCTION_HKNI, //函数定义（function）
    RETURN_HKNI, //返回语句（return）
    TYPE_HKNI, //类型定义（type）
    STRUCT_HKNI, //结构体定义（struct）
    NEW_HKNI, //结构体实例化（new）

    //其他
    IDENTIFIER, //标识符
};
```
