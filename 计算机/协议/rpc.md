---
draft: false
create_date: 2022-12-20 08:00:00 +0800
date: 2023-05-22 08:00:00 +0800
title: "关于 RPC 的基本认知"
summary: "RPC 是什么；RPC 的原理；"
toc: true

categories:
- protocol(协议)

tags:
- computer-science(计算机科学)
- protocol(协议)
- rpc(远程过程调用)
---
## 前言

## 资料

- <a href="/drawio/computer-science/protocol/rpc.drawio.html">rpc.drawio.html</a>

## 正文

### RPC 是什么

RPC 是 Remote Procedure Call 的简写，翻译成中文叫远程过程调用。用这玩意的目的，简单的理解就是，想像使用本地服务一样使用远端服务。

这个怎么理解呢？这里先假定有一个类 A 在 a 服务上，这个类 A 实现了一个方法。

如果现在在 a 服务上有另一个类 B 要调用这个方法，那么通常是直接 new 一个类 A 出来，然后调用方法就行了。

现在如果这个类 A 在远端服务 b 上，怎么办呢？通常情况是 a 服务通过网络，请求 b 服务来达到目的。

比如，可以通过发起一次 TCP 进行访问，可以通过短连接的 HTTP 进行访问，当然长链接的 Socket 的也行。

这些请求方式各不相同，原因是它们对于两个服务之间的沟通方式有着不同约定，这些约定也就是协议。

那么 RPC 协议是啥样的呢？RPC 协议希望，即使类 A 在远端服务 b 上，a 服务上的类 B 依然可以使用 new 一个类 A 出来，然后调用接口的方式达到目的。

这里在 a 服务上的类 A 的使用方式看上去本地调用一样，但是背地里它是通过网络请求，请求了 b 服务，调用了 b 服务上真正的类 A 的接口拿到结果，然后返回给调用者的。

### RPC 的原理

RPC 首先需要定义一个协议，也就是约定两个服务之间的沟通方式。这个协议主要是为了把本地服务的接口调用的信息传递给远端服务。

也就是 a 服务上的类 A 假装自己就是 b 服务上的类 A，这样上游调用的时候，类 A 就可以拿到调用的信息（调了哪个接口，传了哪些参数）。

然后，把这些调用信息传递给 b 服务上真正的类 A 去执行。

这个过程大概可以简单的分成下面几个步骤：

- a 服务上的类 A 需要把自己伪装成 b 服务上的类 A，从外面看上去是一样的。
- a 服务上的类 A 在被调用的时候需要把调用的信息收集起来，然后通过网络传给 b 服务。
- b 服务接收到请求之后需要通过传过来的调用的信息，分析出这个请求调的是类 A，传了哪些参数。
- b 服务 new 一个类 A 出来，使用传过来的参数调用接口拿到结果。
- b 服务拿到结果之后，给 a 服务传回去。a 服务上的类 A 拿到结果之后，对上游做出响应。
